ARM macroassembler      Page:1 
    1 00000000          ; 
    2 00000000          ; Copyright (c) Microsoft Corporation.  All rights reserved. 
    3 00000000          ; 
    4 00000000          ; 
    5 00000000          ; Use of this source code is subject to the terms of the Microsoft end-user 
    6 00000000          ; license agreement (EULA) under which you licensed this SOFTWARE PRODUCT. 
    7 00000000          ; If you did not accept the terms of the EULA, you are not authorized to use 
    8 00000000          ; this source code. For a copy of the EULA, please see the LICENSE.RTF on your 
    9 00000000          ; install media. 
   10 00000000          ; 
   11 00000000          ;TEST_STUB_PWR_OFF EQU 1 
   12 00000000          ;****************************************************************************** 
   13 00000000          ; 
   14 00000000          ;  COPYRIGHT (C) 2002 Intel Corporation. 
   15 00000000          ; 
   16 00000000          ;  This software as well as the software described in it is furnished under  
   17 00000000          ;  license and may only be used or copied in accordance with the terms of the  
   18 00000000          ;  license. The information in this file is furnished for informational use  
   19 00000000          ;  only, is subject to change without notice, and should not be construed as  
   20 00000000          ;  a commitment by Intel Corporation. Intel Corporation assumes no  
   21 00000000          ;  responsibility or liability for any errors or inaccuracies that may appear  
   22 00000000          ;  in this document or any software that may be provided in association with  
   23 00000000          ;  this document. 
   24 00000000          ;  
   25 00000000          ;  Except as permitted by such license, no part of this document may be  
   26 00000000          ;  reproduced, stored in a retrieval system, or transmitted in any form or by  
   27 00000000          ;  any means without the express written consent of Intel Corporation.  
   28 00000000          ; 
   29 00000000          ;  FILENAME:       xllp_Pm_SleepContextA.s 
   30 00000000          ; 
   31 00000000          ;  PURPOSE:        Provides assembly level code to support context saving,  
   32 00000000          ;                  processor sleep and context restoration after sleep 
   33 00000000          ;                  for the Bulverde/Mainstone processor/platform. 
   34 00000000          ;                   
   35 00000000          ; 
   36 00000000          ;  LAST MODIFIED:  8/27/02 
   37 00000000          ;****************************************************************************** 
   38 00000000          ; 
   39 00000000          ; The functions in this source code are called via a branch with link instruction. 
   40 00000000          ; 
   41 00000000          ; NOTES: 
   42 00000000          ; 
   43 00000000          ; These functions assume that the MMU is enabled, except for any which receive all addresses 
   44 00000000          ; as parameters. 
   45 00000000          ; 
   46 00000000                  INCLUDE  xlli_Bulverde_defs.inc                 ; Bulverde specific include file 
    1 00000000          ; 
    2 00000000          ; Copyright (c) Microsoft Corporation.  All rights reserved. 
    3 00000000          ; 
    4 00000000          ; 
    5 00000000          ; Use of this sample source code is subject to the terms of the Microsoft 
    6 00000000          ; license agreement under which you licensed this sample source code. If 
    7 00000000          ; you did not accept the terms of the license agreement, you are not 
    8 00000000          ; authorized to use this sample source code. For the terms of the license, 
    9 00000000          ; please see the license agreement between you and Microsoft or, if applicable, 
   10 00000000          ; see the LICENSE.RTF on your install media or the root of your tools installation. 
   11 00000000          ; THE SAMPLE SOURCE CODE IS PROVIDED "AS IS", WITH NO WARRANTIES. 
   12 00000000          ; 
   13 00000000          ;********************************************************************************* 
   14 00000000          ; 
   15 00000000          ;        COPYRIGHT (c) 2002 Intel Corporation 
   16 00000000          ; 
   17 00000000          ;   The information in this file is furnished for informational use only, 
   18 00000000          ;   is subject to change without notice, and should not be construed as 
   19 00000000          ;   a commitment by Intel Corporation. Intel Corporation assumes no 
   20 00000000          ;   responsibility or liability for any errors or inaccuracies that may appear 
   21 00000000          ;   in this document or any software that may be provided in association with 
   22 00000000          ;   this document. 
   23 00000000          ; 
   24 00000000          ;********************************************************************************* 
   25 00000000          ; 
   26 00000000          ;  FILENAME:       xlli_Bulverde_defs.inc (Core processor address definitions) 
   27 00000000          ; 
   28 00000000          ; LAST MODIFIED:   1-Mar-2006 
   29 00000000          ; 
   30 00000000          ;****************************************************************************** 
   31 00000000          ; 
   32 00000000          ; 
   33 00000000          ; Include file for PXA27x Processor based 
   34 00000000          ; Cross Platform Low Level Initialization  (XLLI) 
   35 00000000          ; 
   36 00000000          ;****************************************************************************** 
   37 00000000            
   38 00000000          ;     Bit settings 
   39 00000000          ; 
   40 00000000          xlli_BIT_0      EQU     0x00000001 
   41 00000000          xlli_BIT_1      EQU     0x00000002 
   42 00000000          xlli_BIT_2      EQU     0x00000004 
   43 00000000          xlli_BIT_3      EQU     0x00000008 
   44 00000000          xlli_BIT_4      EQU     0x00000010 
   45 00000000          xlli_BIT_5      EQU     0x00000020 
   46 00000000          xlli_BIT_6      EQU     0x00000040 
   47 00000000          xlli_BIT_7      EQU     0x00000080 
   48 00000000          xlli_BIT_8      EQU     0x00000100 
   49 00000000          xlli_BIT_9      EQU     0x00000200 
   50 00000000          xlli_BIT_10     EQU     0x00000400 
   51 00000000          xlli_BIT_11     EQU     0x00000800 
   52 00000000          xlli_BIT_12     EQU     0x00001000 
   53 00000000          xlli_BIT_13     EQU     0x00002000 
   54 00000000          xlli_BIT_14     EQU     0x00004000 
   55 00000000          xlli_BIT_15     EQU     0x00008000 
   56 00000000          xlli_BIT_16     EQU     0x00010000 
   57 00000000          xlli_BIT_17     EQU     0x00020000 
   58 00000000          xlli_BIT_18     EQU     0x00040000 
   59 00000000          xlli_BIT_19     EQU     0x00080000 
   60 00000000          xlli_BIT_20     EQU     0x00100000 
   61 00000000          xlli_BIT_21     EQU     0x00200000 
   62 00000000          xlli_BIT_22     EQU     0x00400000 
   63 00000000          xlli_BIT_23     EQU     0x00800000 
   64 00000000          xlli_BIT_24     EQU     0x01000000 
   65 00000000          xlli_BIT_25     EQU     0x02000000 
   66 00000000          xlli_BIT_26     EQU     0x04000000 
   67 00000000          xlli_BIT_27     EQU     0x08000000 
   68 00000000          xlli_BIT_28     EQU     0x10000000 
   69 00000000          xlli_BIT_29     EQU     0x20000000 
   70 00000000          xlli_BIT_30     EQU     0x40000000 
   71 00000000          xlli_BIT_31     EQU     0x80000000 
   72 00000000            
   73 00000000          ; 
   74 00000000          ;  Processor stepping Values 
   75 00000000          ; 
   76 00000000          xlli_PXA27x_CP15_A0_Val  EQU (0x69054110) 
   77 00000000          xlli_PXA27x_CP15_A1_Val  EQU (0x69054111) 
   78 00000000          xlli_PXA27x_CP15_B0_Val  EQU (0x69054112) 
   79 00000000          xlli_PXA27x_CP15_B1_Val  EQU (0x69054113) 
   80 00000000          xlli_PXA27x_CP15_C0_Val  EQU (0x69054114) 
   81 00000000          xlli_PXA27x_CP15_C5_Val  EQU (0x69054117) 
   82 00000000            
   83 00000000          xlli_PXA27x_JTAG_A0_Val  EQU (0x09265013) 
   84 00000000          xlli_PXA27x_JTAG_A1_Val  EQU (0x19265013) 
   85 00000000          xlli_PXA27x_JTAG_B0_Val  EQU (0x29265013) 
   86 00000000          xlli_PXA27x_JTAG_B1_Val  EQU (0x39265013) 
   87 00000000          xlli_PXA27x_JTAG_C0_Val  EQU (0x49265013) 
   88 00000000          xlli_PXA27x_JTAG_C5_Val  EQU (0x79265013) 
   89 00000000            
   90 00000000          xlli_PXA27x_A0_stepping  EQU (0x0) 
   91 00000000          xlli_PXA27x_A1_stepping  EQU (0x1) 
   92 00000000          xlli_PXA27x_B0_stepping  EQU (0x2) 
   93 00000000          xlli_PXA27x_B1_stepping  EQU (0x3) 
   94 00000000          xlli_PXA27x_C0_stepping  EQU (0x4) 
   95 00000000          xlli_PXA27x_C5_stepping  EQU (0x7) 
   96 00000000            
   97 00000000            
   98 00000000          ; 
   99 00000000          ; GENERAL PURPOSE I/O (GPIO) base address and register offsets from the base address 
  100 00000000          ; 
  101 00000000            
  102 00000000          xlli_GPIOREGS_PHYSICAL_BASE  EQU    0x40E00000 
  103 00000000            
  104 00000000          ; GPIO register offsets from the base address 
  105 00000000            
  106 00000000          xlli_GPLR0_offset    EQU    (0x000)  ; GPIO Level registers 
  107 00000000          xlli_GPLR1_offset    EQU    (0x004) 
  108 00000000          xlli_GPLR2_offset    EQU    (0x008) 
  109 00000000          xlli_GPLR3_offset    EQU    (0x100) 
  110 00000000            
  111 00000000          xlli_GPDR0_offset    EQU    (0x00C)  ; GPIO Direction registers 
  112 00000000          xlli_GPDR1_offset    EQU    (0x010) 
  113 00000000          xlli_GPDR2_offset    EQU    (0x014) 
  114 00000000          xlli_GPDR3_offset    EQU    (0x10C) 
  115 00000000            
  116 00000000          xlli_GPSR0_offset    EQU    (0x018)  ; GPIO Set registers 
  117 00000000          xlli_GPSR1_offset    EQU    (0x01C) 
  118 00000000          xlli_GPSR2_offset    EQU    (0x020) 
  119 00000000          xlli_GPSR3_offset    EQU    (0x118) 
  120 00000000            
  121 00000000          xlli_GPCR0_offset    EQU    (0x024)  ; GPIO Clear registers 
  122 00000000          xlli_GPCR1_offset    EQU    (0x028) 
  123 00000000          xlli_GPCR2_offset    EQU    (0x02C) 
  124 00000000          xlli_GPCR3_offset    EQU    (0x124) 
  125 00000000            
  126 00000000          xlli_GAFR0_L_offset  EQU    (0x054)  ; GPIO Alternate function registers (Bits 15:0) 
  127 00000000          xlli_GAFR0_U_offset  EQU    (0x058)  ; Bits 31:16 
  128 00000000          xlli_GAFR1_L_offset  EQU    (0x05c)  ; Bits 47:32 
  129 00000000          xlli_GAFR1_U_offset  EQU    (0x060)  ; Bits 63:48 
  130 00000000          xlli_GAFR2_L_offset  EQU    (0x064)  ; Bits 79:64 
  131 00000000          xlli_GAFR2_U_offset  EQU    (0x068)  ; Bits 95:80 
  132 00000000          xlli_GAFR3_L_offset  EQU    (0x06C)  ; Bits 111:96 
  133 00000000          xlli_GAFR3_U_offset  EQU    (0x070)  ; Bits 127:112 
  134 00000000            
  135 00000000          ; 
  136 00000000          ; GPIO register bit masks 
  137 00000000          ; 
  138 00000000          xlli_GPIO_BIT_FFRXD    EQU      (xlli_BIT_2) 
  139 00000000          xlli_GPIO_BIT_FFCTS    EQU      (xlli_BIT_3) 
  140 00000000          xlli_GPIO_BIT_FFDCD    EQU      (xlli_BIT_4) 
  141 00000000          xlli_GPIO_BIT_FFDSR    EQU      (xlli_BIT_5) 
  142 00000000          xlli_GPIO_BIT_FFRI     EQU      (xlli_BIT_6) 
  143 00000000          xlli_GPIO_BIT_FFTXD    EQU      (xlli_BIT_7) 
  144 00000000          xlli_GPIO_BIT_FFDTR    EQU      (xlli_BIT_8) 
  145 00000000          xlli_GPIO_BIT_FFRTS    EQU      (xlli_BIT_9) 
  146 00000000            
  147 00000000          xlli_GPIO_AF_BIT_FFRXD EQU      (xlli_BIT_4) 
  148 00000000          xlli_GPIO_AF_BIT_FFCTS EQU      (xlli_BIT_6) 
  149 00000000          xlli_GPIO_AF_BIT_FFDCD EQU      (xlli_BIT_8) 
  150 00000000          xlli_GPIO_AF_BIT_FFDSR EQU      (xlli_BIT_10) 
  151 00000000          xlli_GPIO_AF_BIT_FFRI  EQU      (xlli_BIT_12) 
  152 00000000          xlli_GPIO_AF_BIT_FFTXD EQU      (xlli_BIT_15) 
  153 00000000          xlli_GPIO_AF_BIT_FFDTR EQU      (xlli_BIT_17) 
  154 00000000          xlli_GPIO_AF_BIT_FFRTS EQU      (xlli_BIT_19) 
  155 00000000            
  156 00000000          ; 
  157 00000000          ; POWER MANAGER base address and register offsets from the base address 
  158 00000000          ; 
  159 00000000            
  160 00000000          xlli_PMRCREGS_PHYSICAL_BASE  EQU    0x40F00000  
  161 00000000            
  162 00000000          xlli_PMCR_offset     EQU    (0x00)      ; Power Manager Control Register 
  163 00000000          xlli_PSSR_offset     EQU    (0x04)      ; Power Manager Sleep Status Register 
  164 00000000          xlli_PSPR_offset     EQU    (0x08)      ; Power Manager Scratch Pad Register 
  165 00000000          xlli_PWER_offset     EQU    (0x0C)      ; Power Manager Wake-up Enable Register 
  166 00000000          xlli_PRER_offset     EQU    (0x10)      ; Power Manager GPIO Rising-edge Detect Enable Register 
  167 00000000          xlli_PFER_offset     EQU    (0x14)      ; Power Manager GPIO Falling-edge Detect Enable Register 
  168 00000000          xlli_PEDR_offset     EQU    (0x18)      ; Power Manager GPIO Edge Detect Status Register 
  169 00000000          xlli_PCFR_offset     EQU    (0x1C)      ; Power Manager General Configuration Register 
  170 00000000          xlli_PGSR0_offset    EQU    (0x20)      ; Power Manager GPIO Sleep State Register for GP [31-0] 
  171 00000000          xlli_PGSR1_offset    EQU    (0x24)      ; Power Manager GPIO Sleep State Register for GP [63-32] 
  172 00000000          xlli_PGSR2_offset    EQU    (0x28)      ; Power Manager GPIO Sleep State Register for GP [95-64] 
  173 00000000          xlli_PGSR3_offset    EQU    (0x2C)      ; Power Manager GPIO Sleep State Register for GP [120-96] 
  174 00000000          xlli_RCSR_offset     EQU    (0x30)      ; Reset Controller Status Register 
  175 00000000          xlli_PSLR_offset     EQU    (0x34)      ; Power Manager Sleep Mode Config Register 
  176 00000000          xlli_PSTR_offset     EQU    (0x38)      ; Power Manager Standby Mode Config Register 
  177 00000000          xlli_PSNR_offset     EQU    (0x3C)      ; Power Manager Sense Moce Config Register 
  178 00000000          xlli_PVCR_offset     EQU    (0x40)      ; Power Manager Voltage Change Control Register 
  179 00000000          xlli_PKWR_offset     EQU    (0x50)      ; Power Manager Keyboard Wake-up Enable Register 
  180 00000000          xlli_PKSR_offset     EQU    (0x54)      ; Power Manager Keyboard Edge-Detect Status Register 
  181 00000000          xlli_PI2DBR_offset   EQU   (0x188)      ; Power I2C Data Buffer Register 
  182 00000000          xlli_PI2CR_offset    EQU   (0x190)      ; Power I2C Control Register 
  183 00000000          xlli_PI2SR_offset    EQU   (0x198)      ; Power I2C Status Register 
  184 00000000          xlli_PI2SAR_offset   EQU   (0x1A0)      ; Power I2C Slave Address Register 
  185 00000000            
  186 00000000          ; 
  187 00000000          ; POWER MANAGER register bit masks  
  188 00000000          ; 
  189 00000000          xlli_PSSR_SSS           EQU    (0x01)   ; Software Sleep Status 
  190 00000000          xlli_PSSR_BFS           EQU    (0x02)   ; Battery Fault Status 
  191 00000000          xlli_PSSR_VFS           EQU    (0x04)   ; VCC Fault Status 
  192 00000000          xlli_PSSR_PH            EQU    (0x10)   ; Peripheral Control Hold 
  193 00000000          xlli_PSSR_RDH           EQU    (0x20)   ; Read Disable Hold 
  194 00000000            
  195 00000000          xlli_PCFR_OPDE          EQU    (0x01)   ; Processor (13MHz) osc power-down enable 
  196 00000000          xlli_PCFR_FP            EQU    (0x02)   ; Float PCMCIA during sleep modes 
  197 00000000          xlli_PCFR_FS            EQU    (0x04)   ; Float Static Chip Selects 
  198 00000000          xlli_PCFR_GPR_EN        EQU    (0x10)   ; GPIO 1 performs GPIO reset 
  199 00000000          xlli_PCFR_SYSEN_EN      EQU    (0x20)   ; SYS_EN pin 
  200 00000000          xlli_PCFR_PI2C_EN       EQU    (0x40)   ; 
  201 00000000          xlli_PCFR_DC_EN         EQU    (0x80)      ; Deep-Sleep Mode 
  202 00000000          xlli_PCFR_FVC           EQU    (0x400)  ; 
  203 00000000          xlli_PCFR_L1_EN         EQU    (0x800)  ; 
  204 00000000          xlli_PCFR_GPROD         EQU    (0x1000) ; 
  205 00000000          xlli_PCFR_PO            EQU    (0x4000) ; 
  206 00000000          xlli_PCFR_RO            EQU    (0x8000) ; 
  207 00000000          xlli_PCFR_USEDBITS      EQU     (xlli_PCFR_OPDE :OR: xlli_PCFR_FP :OR: xlli_PCFR_FS :OR: xlli_PCFR_GPR_EN :OR:                 
                                         xlli_PCFR_SYSEN_EN :OR: xlli_PCFR_PI2C_EN :OR: xlli_PCFR_DC_EN :OR: xlli_PCFR_FVC :OR:                        
                                  xlli_PCFR_L1_EN :OR: xlli_PCFR_GPROD :OR: xlli_PCFR_PO :OR: xlli_PCFR_RO) 
  210 00000000            
  211 00000000          xlli_PSLR_SL_PI_OFF     EQU   (0x00000000)      ; PI power domain is powered off in sleep and deep sleep mode 
  212 00000000          xlli_PSLR_SL_PI_RETAIN  EQU   (0x00000004)      ; PI power domain retains state in sleep and deep sleep mode 
  213 00000000          xlli_PSLR_SL_PI_RUN     EQU   (0x00000008)      ; PI power domain is active with clocks running in sleep mode (DO NOT set for  
                        deep-sleep mode) 
  214 00000000          xlli_PSLR_SL_PI_RSVD    EQU   (0x0000000C)      ; PI power domain reserved bits 
  215 00000000          xlli_PSLR_SL_R0         EQU   (0x00000100)      ; SRAM Bank 0 retains state in sleep mode 
  216 00000000          xlli_PSLR_SL_R1         EQU   (0x00000200)      ; SRAM Bank 1 retains state in sleep mode 
  217 00000000          xlli_PSLR_SL_R2         EQU   (0x00000400)      ; SRAM Bank 2 retains state in sleep mode 
  218 00000000          xlli_PSLR_SL_R3         EQU   (0x00000800)      ; SRAM Bank 3 retains state in sleep mode 
  219 00000000          xlli_PSLR_SL_ROD        EQU   (0x00100000)      ; 1 = nRESET_OUT is not asserted upon entry into sleep or deep-sleep mode 
  220 00000000          xlli_PSLR_IVF           EQU   (0x00400000)      ; 1 = No action taken when nVV_FAULT occurs in sleep mode 
  221 00000000          xlli_PSLR_PSSD          EQU   (0x00800000)      ; 1 = shorten the wake-up delay if all corresponding power supplies are detect 
                        ed to have powered on 
  222 00000000          xlli_PSLR_PWR_DEL_MAX   EQU   (0x0f000000)      ; max power supply PWR_EN ramp delay 
  223 00000000          xlli_PSLR_SYS_DEL_MAX   EQU   (0xf0000000)      ; max system power supply SYS_EN ramp delay 
  224 00000000          xlli_PSLR_USEDBITS      EQU   (xlli_PSLR_SL_PI_RSVD :OR: xlli_PSLR_SL_R0 :OR:                                 xlli_PSLR_SL_R1  
                        :OR: xlli_PSLR_SL_R2 :OR:                                 xlli_PSLR_SL_R3 :OR: xlli_PSLR_SL_ROD :OR:                           
                               xlli_PSLR_IVF :OR: xlli_PSLR_PSSD :OR:                                 xlli_PSLR_PWR_DEL_MAX :OR: xlli_PSLR_SYS_DEL_MAX 
                        ) 
  229 00000000                                           
  230 00000000          xlli_PWER_WE0     EQU    (0x01)      ; Wake-up Enable GPIO pin 0 
  231 00000000          xlli_PWER_WE1     EQU    (0x02)      ; Wake-up Enable GPIO pin 1 
  232 00000000          xlli_PWER_WERTC   EQU    (0x80000000); RTC Standby, Wake-up Enable- 
  233 00000000            
  234 00000000          ; 
  235 00000000          ; MEMORY CONTROLLER base address and register offsets from the base address  
  236 00000000          ; 
  237 00000000            
  238 00000000          xlli_MEMORY_CONFIG_BASE       EQU   0x48000000 
  239 00000000            
  240 00000000          xlli_MDCNFG_offset    EQU     (0x00) 
  241 00000000          xlli_MDREFR_offset    EQU     (0x04) 
  242 00000000          xlli_MSC0_offset      EQU     (0x08) 
  243 00000000          xlli_MSC1_offset      EQU     (0x0C) 
  244 00000000          xlli_MSC2_offset      EQU     (0x10) 
  245 00000000          xlli_MECR_offset      EQU     (0x14) 
  246 00000000          xlli_SXLCR_offset     EQU     (0x18) 
  247 00000000          xlli_SXCNFG_offset    EQU     (0x1C) 
  248 00000000          xlli_FLYCNFG_offset   EQU     (0x20) 
  249 00000000          xlli_SXMRS_offset     EQU     (0x24)                                        
  250 00000000          xlli_MCMEM0_offset    EQU     (0x28) 
  251 00000000          xlli_MCMEM1_offset    EQU     (0x2C) 
  252 00000000          xlli_MCATT0_offset    EQU     (0x30) 
  253 00000000          xlli_MCATT1_offset    EQU     (0x34) 
  254 00000000          xlli_MCIO0_offset     EQU     (0x38) 
  255 00000000          xlli_MCIO1_offset     EQU     (0x3C) 
  256 00000000          xlli_MDMRS_offset     EQU     (0x40) 
  257 00000000          xlli_BOOT_DEF_offset  EQU     (0x44) 
  258 00000000          xlli_ARB_CNTL_offset  EQU     (0x48) 
  259 00000000          xlli_BSCNTR0_offset   EQU     (0x4C) 
  260 00000000          xlli_BSCNTR1_offset   EQU     (0x50) 
  261 00000000          xlli_LCDBSCNTR_offset EQU     (0x54) 
  262 00000000          xlli_MDMRSLP_offset   EQU     (0x58) 
  263 00000000          xlli_BSCNTR2_offset   EQU     (0x5C) 
  264 00000000          xlli_BSCNTR3_offset   EQU     (0x60) 
  265 00000000            
  266 00000000          ; Memory Controller bit defs 
  267 00000000            
  268 00000000          xlli_MDREFR_K0DB4     EQU     (0x20000000)    ; Sync Static Clock 0 divide by 4 control/status 
  269 00000000          xlli_MDREFR_K2FREE    EQU     (0x02000000)    ; Set to force SDCLK[2] to be free running 
  270 00000000          xlli_MDREFR_K1FREE    EQU     (0x01000000)    ; Set to force SDCLK[1] to be free running 
  271 00000000          xlli_MDREFR_K0FREE    EQU     (0x00800000)    ; Set to force SDCLK[0] to be free running 
  272 00000000          xlli_MDREFR_SLFRSH    EQU     (0x00400000)    ; Self Refresh Control Status bit 
  273 00000000          xlli_MDREFR_APD       EQU     (0x00100000)    ; Auto Power Down bit 
  274 00000000          xlli_MDREFR_K2DB2     EQU     (0x00080000)    ; SDRAM clock pin 2 divide by 2 control/status 
  275 00000000          xlli_MDREFR_K2RUN     EQU     (0x00040000)    ; SDRAM clock pin 2 run/control status 
  276 00000000          xlli_MDREFR_K1DB2     EQU     (0x00020000)    ; SDRAM clock pin 1 divide by 2 control/status 
  277 00000000          xlli_MDREFR_K1RUN     EQU     (0x00010000)    ; SDRAM clock pin 1 run/control status 
  278 00000000          xlli_MDREFR_E1PIN     EQU     (0x00008000)    ; SDRAM clock Enable pin 1 level control/status 
  279 00000000          xlli_MDREFR_K0DB2     EQU     (0x00004000)    ; Sync Static Memory Clock divide by 2 control/status 
  280 00000000          xlli_MDREFR_K0RUN     EQU     (0x00002000)    ; Sync Static Memory Clock Pin 0 
  281 00000000          xlli_MDREFR_E0PIN     EQU     (0x00000100)    ; SDRAM clock enable pin 0 (Cotulla ONLY!!) 
  282 00000000            
  283 00000000          xlli_MDCNFG_DE0       EQU     (0x00000001)    ; SDRAM enable bit for partition 0 
  284 00000000          xlli_MDCNFG_DE1       EQU     (0x00000002)    ; SDRAM enable bit for partition 1 
  285 00000000          xlli_MDCNFG_DE2       EQU     (0x00010000)    ; SDRAM enable bit for partition 2 
  286 00000000          xlli_MDCNFG_DE3       EQU     (0x00020000)    ; SDRAM enable bit for partition 3 
  287 00000000          xlli_MDCNFG_DWID0     EQU     (0x00000004)    ; SDRAM bus width (clear = 32 bits, set = 16 bits) 
  288 00000000          xlli_MDCNFG_DWID2     EQU     (0x00040000)    ; SDRAM bus width (clear = 32 bits, set = 16 bits) 
  289 00000000          xlli_MDCNFG_DCAC0     EQU     (0x00000008) 
  290 00000000          xlli_MDCNFG_DCAC2     EQU     (0x00080000) 
  291 00000000            
  292 00000000          ; 
  293 00000000          ; INTERNAL MEMORY CONTROLLER base address and register offsets from the base address  
  294 00000000          ; 
  295 00000000            
  296 00000000          xlli_IMEMORY_CONFIG_BASE      EQU   (0x58000000) 
  297 00000000            
  298 00000000          xlli_IMPMCR_offset   EQU     (0x00)       ; Internal Memory Power Manager Control Register 
  299 00000000          xlli_IMPMSR_offset   EQU     (0x08)       ; Internal Memory Power Management Status Register 
  300 00000000            
  301 00000000            
  302 00000000          ; 
  303 00000000          ; UART Definitions 
  304 00000000          ; 
  305 00000000          xlli_perif_base                 EQU     (0x40000000)    ; Base address of the peripherals 
  306 00000000          xlli_ffuart_offset              EQU     (0x00100000)    ; Offset to the Full-Feature UART in the peripheral block 
  307 00000000          xlli_btuart_offset              EQU     (0x00200000)    ; Offset to the BlueTooth UART in the peripheral block 
  308 00000000          xlli_stuart_offset              EQU     (0x00700000)    ; Offset to the Standard UART in the peripheral block 
  309 00000000            
  310 00000000            
  311 00000000          xlli_uart_thr_offset            EQU     (0x0)       ;DLAB = 0  WO  8bit - Transmit Holding Register 
  312 00000000          xlli_uart_rbr_offset            EQU     (0x0)       ;DLAB = 0  RO  8bit - Recieve Buffer Register 
  313 00000000          xlli_uart_dll_offset            EQU     (0x0)       ;DLAB = 1  RW  8bit - Divisor Latch Low Register 
  314 00000000          xlli_uart_ier_offset            EQU     (0x4)       ;DLAB = 0  RW  8bit - Interrupt Enable Register 
  315 00000000          xlli_uart_dlh_offset            EQU     (0x4)       ;DLAB = 1  RW  8bit - Divisor Latch High Register 
  316 00000000          xlli_uart_iir_offset            EQU     (0x8)       ;DLAB = X  RO  8bit - Interrupt Identification Register 
  317 00000000          xlli_uart_fcr_offset            EQU     (0x8)       ;DLAB = X  WO  8bit - FIFO Control Register 
  318 00000000          xlli_uart_lcr_offset            EQU     (0xC)       ;DLAB = X  RW  8bit - Line Control Register 
  319 00000000          xlli_uart_mcr_offset            EQU     (0x10)      ;DLAB = X  RW  8bit - Modem Control Regiser 
  320 00000000          xlli_uart_lsr_offset            EQU     (0x14)      ;DLAB = X  RO  8bit - Line Status Register 
  321 00000000          xlli_uart_msr_offset            EQU     (0x18)      ;DLAB = X  RO  8bit - Modem Status Register 
  322 00000000          xlli_uart_spr_offset            EQU     (0x1C)      ;DLAB = X  RW  8bit - Scratchpad Register 
  323 00000000          xlli_uart_isr_offset            EQU     (0x20)      ;DLAB = X  RW  8bit - Slow Infrared Select Register 
  324 00000000          xlli_uart_for_offset            EQU     (0x24)      ;DLAB = X  RO  FIFO Occupancy Register 
  325 00000000          xlli_uart_abr_offset            EQU     (0x28)      ;DLAB = X  RW  Autobaud Control Register 
  326 00000000          xlli_uart_acr_offset            EQU     (0x2C)      ;DLAB = X Autobaud Count Register 
  327 00000000            
  328 00000000          ; 
  329 00000000          ; INTERRUPT CONTROLLER base address and register offsets from the base address 
  330 00000000          ;  
  331 00000000          ; 
  332 00000000            
  333 00000000          xlli_INTERREGS_PHYSICAL_BASE      EQU     (0x40D00000) 
  334 00000000            
  335 00000000          xlli_ICIP_offset      EQU     (0x00)   ; Interrupt Controller IRQ Pending Register 
  336 00000000          xlli_ICMR_offset      EQU     (0x04)   ; Interrupt Controller Mask Register 
  337 00000000          xlli_ICLR_offset      EQU     (0x08)   ; Interrupt Controller Level Register 
  338 00000000          xlli_ICFP_offset      EQU     (0x0C)   ; Interrupt Controller FIQ pending Register 
  339 00000000          xlli_ICPR_offset      EQU     (0x10)   ; Interrupt Controller Pending Register 
  340 00000000          xlli_ICCR_offset      EQU     (0x14)   ; Interrupt Controller Control Register 
  341 00000000          xlli_ICHP_offset      EQU     (0x18)   ; Interrupt Controller Highest Priority Reg 
  342 00000000          xlli_ICMR2_offset     EQU     (0xA0)   ; Interrupt Controller Mask Register 2 
  343 00000000          xlli_ICLR2_offset     EQU     (0xA4)   ; Interrupt Controller Level Register 2 
  344 00000000          xlli_ICCR2_offset     EQU     (0xAC)   ; Interrupt Controller Control Register 2 
  345 00000000            
  346 00000000          ; 
  347 00000000          ; SSP SERIAL PORTS base address and register offsets from the base address 
  348 00000000          ;  
  349 00000000            
  350 00000000          xlli_SSP_PHYSICAL_BASE EQU    (0x40100000) 
  351 00000000            
  352 00000000          xlli_SSCR0_1_offset    EQU    (0x00)   ; SSP 1 Control Regsiter 0 
  353 00000000          xlli_SSCR1_1_offset    EQU    (0x04)   ; SSP 1 Control Register 1 
  354 00000000          xlli_SSSR_1_offset     EQU    (0x08)   ; SSP 1 Status Register 
  355 00000000          xlli_SSITR_1_offset    EQU    (0x0C)   ; SSP 1 Interrupt Test Register 
  356 00000000          xlli_SSDR_1_offset     EQU    (0x10)   ; SSP 1 Data Write Register/Data Read Register 
  357 00000000            
  358 00000000          ; 
  359 00000000          ; CLOCK REGISTERS base address and register offsets from the base address 
  360 00000000          ;  
  361 00000000            
  362 00000000          xlli_CLKREGS_PHYSICAL_BASE        EQU     (0x41300000) 
  363 00000000            
  364 00000000          xlli_CCCR_offset     EQU     (0x00)    ; Core Clock Configuration Register 
  365 00000000          xlli_CKEN_offset     EQU     (0x04)    ; Clock-Enable Register 
  366 00000000          xlli_OSCC_offset     EQU     (0x08)    ; Oscillator Configuration Register 
  367 00000000          xlli_CCSR_offset     EQU     (0x0C)    ; Core Clock Status Register 
  368 00000000            
  369 00000000          xlli_CCCR_A_Bit_Mask EQU     (0x1 << 25)  ; "A" bit is bit 25 in CCCR 
  370 00000000          ; 
  371 00000000          ; OS TIMER REGISTERS base address and register offsets from the base address 
  372 00000000          ;  
  373 00000000            
  374 00000000          xlli_OSTREGS_PHYSICAL_BASE        EQU     (0x40A00000) 
  375 00000000            
  376 00000000          xlli_OSMR0_offset    EQU     (0x00)    ; OS Timer Match Register 0 
  377 00000000          xlli_OSMR1_offset    EQU     (0x04)    ; OS Timer Match Register 1 
  378 00000000          xlli_OSMR2_offset    EQU     (0x08)    ; OS Timer Match Register 2 
  379 00000000          xlli_OSMR3_offset    EQU     (0x0C)    ; OS Timer Match Register 3 
  380 00000000            
  381 00000000          xlli_OSCR0_offset    EQU     (0x10)    ; OS Timer Count Register 0 
  382 00000000          xlli_OSSR_offset     EQU     (0x14)    ; OS Timer Status Register 
  383 00000000          xlli_OWER_offset     EQU     (0x18)    ; OS Timer Watchdog Enable Register 
  384 00000000          xlli_OIER_offset     EQU     (0x1C)    ; OS Timer Interrupt Enable Register 
  385 00000000            
  386 00000000          xlli_OSCR4_offset    EQU     (0x40)    ; OS Timer Count Register 4 
  387 00000000          xlli_OSCR5_offset    EQU     (0x44)    ; OS Timer Count Register 5 
  388 00000000          xlli_OSCR6_offset    EQU     (0x48)    ; OS Timer Count Register 6 
  389 00000000          xlli_OSCR7_offset    EQU     (0x4C)    ; OS Timer Count Register 7 
  390 00000000          xlli_OSCR8_offset    EQU     (0x50)    ; OS Timer Count Register 8 
  391 00000000          xlli_OSCR9_offset    EQU     (0x54)    ; OS Timer Count Register 9 
  392 00000000          xlli_OSCR10_offset   EQU     (0x58)    ; OS Timer Count Register 10 
  393 00000000          xlli_OSCR11_offset   EQU     (0x5C)    ; OS Timer Count Register 11 
  394 00000000            
  395 00000000          xlli_OSMR4_offset    EQU     (0x80)    ; OS Timer Match Register 4 
  396 00000000          xlli_OSMR5_offset    EQU     (0x84)    ; OS Timer Match Register 5 
  397 00000000          xlli_OSMR6_offset    EQU     (0x88)    ; OS Timer Match Register 6 
  398 00000000          xlli_OSMR7_offset    EQU     (0x8C)    ; OS Timer Match Register 7 
  399 00000000          xlli_OSMR8_offset    EQU     (0x90)    ; OS Timer Match Register 8 
  400 00000000          xlli_OSMR9_offset    EQU     (0x94)    ; OS Timer Match Register 9 
  401 00000000          xlli_OSMR10_offset   EQU     (0x98)    ; OS Timer Match Register 10 
  402 00000000          xlli_OSMR11_offset   EQU     (0x9C)    ; OS Timer Match Register 11 
  403 00000000            
  404 00000000          xlli_OMCR4_offset    EQU     (0xC0)    ; OS Timer Match Control Register 4 
  405 00000000          xlli_OMCR5_offset    EQU     (0xC4)    ; OS Timer Match Control Register 5 
  406 00000000          xlli_OMCR6_offset    EQU     (0xC8)    ; OS Timer Match Control Register 6 
  407 00000000          xlli_OMCR7_offset    EQU     (0xCC)    ; OS Timer Match Control Register 7 
  408 00000000          xlli_OMCR8_offset    EQU     (0xD0)    ; OS Timer Match Control Register 8 
  409 00000000          xlli_OMCR9_offset    EQU     (0xD4)    ; OS Timer Match Control Register 9 
  410 00000000          xlli_OMCR10_offset   EQU     (0xD8)    ; OS Timer Match Control Register 10 
  411 00000000          xlli_OMCR11_offset   EQU     (0xDC)    ; OS Timer Match Control Register 11 
  412 00000000            
  413 00000000          xlli_OSSR_ALL        EQU     (0xFFF)   ; Match register status "sticky bits" 
  414 00000000          xlli_OIER_E1         EQU     (0x002)   ; Interrupt enable bit for match register #1 
  415 00000000            
  416 00000000          ; 
  417 00000000          ; REAL TIME CLOCK (RTC) REGISTERS base address and register offsets from the base address 
  418 00000000          ;  
  419 00000000            
  420 00000000          xlli_RTCREGS_PHYSICAL_BASE   EQU       (0x40900000) 
  421 00000000            
  422 00000000          xlli_RCNR_offset     EQU     (0x00)    ; RTC Counter Register 
  423 00000000          xlli_RTAR_offset     EQU     (0x04)    ; RTC Alarm Register 
  424 00000000          xlli_RTSR_offset     EQU     (0x08)    ; RTC Status Register 
  425 00000000          xlli_RTTR_offset     EQU     (0x0C)    ; RTC Timer Trim Register 
  426 00000000          xlli_RDCR_offset     EQU     (0x10)    ; RTC Day Counter Register 
  427 00000000          xlli_RYCR_offset     EQU     (0x14)    ; RTC Year Counter Register  
  428 00000000          xlli_RDAR1_offset    EQU     (0x18)    ; RTC Day Alarm Register 1 
  429 00000000          xlli_RYAR1_offset    EQU     (0x1C)    ; RTC Year Alarm Register 2 
  430 00000000          xlli_RDAR2_offset    EQU     (0x20)    ; RTC Day Alarm Register 2 
  431 00000000          xlli_RYAR2_offset    EQU     (0x24)    ; RTC Year Alarm Register 2 
  432 00000000          xlli_SWCR_offset     EQU     (0x28)    ; Stopwatch Counter Register 
  433 00000000          xlli_SWAR1_offset    EQU     (0x2C)    ; Stopwatch Alarm Register 1 
  434 00000000          xlli_SWAR2_offset    EQU     (0x30)    ; Stopwatch Alarm Register 2 
  435 00000000          xlli_PICR_offset     EQU     (0x34)    ; Periodic Interrupt Counter Register 
  436 00000000          xlli_PIAR_offset     EQU     (0x38)    ; Periodic Interrupt Alarm Register 
  437 00000000            
  438 00000000            
  439 00000000          ; Oscillator Controller bit defs 
  440 00000000            
  441 00000000          xlli_OSCC_OOK        EQU     (0x01)    ; Oscillator OK bit 
  442 00000000          xlli_OSCC_OON        EQU     (0x02)    ; Timekeeping (32.768KHz) Osc bit 
  443 00000000          xlli_OSCC_TOUT_EN    EQU     (0x04)    ; Timekeeping Output enable 
  444 00000000          xlli_OSCC_PIO_EN     EQU     (0x08)    ; Processor Oscillator Output Enable 
  445 00000000          xlli_OSCC_CRI        EQU     (0x10)    ; Processor Oscillator Output Enable 
  446 00000000            
  447 00000000          ; 
  448 00000000          ; Coprocessor 15 data bits 
  449 00000000          ;  
  450 00000000            
  451 00000000          xlli_control_icache  EQU     (0x1000)  ; bit 12 -  i-cache bit 
  452 00000000          xlli_control_btb     EQU     (0x0800)  ; bit 11 -  btb bit 
  453 00000000          xlli_control_r       EQU     (0x0200)  ; Bit 9 
  454 00000000          xlli_control_s       EQU     (0x0100)  ; Bit 8 
  455 00000000          xlli_control_dcache  EQU     (0x0004)  ; Bit 2  -  d-cache bit 
  456 00000000          xlli_control_mmu     EQU     (0x0001)  ; Bit 0  -  MMU bit 
  457 00000000            
  458 00000000            
  459 00000000          ; 
  460 00000000          ; CP 15 related settings 
  461 00000000          ; 
  462 00000000            
  463 00000000          xlli_PID                   EQU     (0x00) 
  464 00000000          xlli_DACR                  EQU     (0x01) 
  465 00000000          xlli_CONTROL_DCACHE        EQU     (0x04) 
  466 00000000          xlli_CONTROL_MINIDATA_01   EQU     (0x10) 
  467 00000000          xlli_CONTROL_BTB           EQU     (0x800)   ; Brach Target Buffer bit 
  468 00000000            
  469 00000000          ; 
  470 00000000          ; register bit masks - RCSR 
  471 00000000          ; 
  472 00000000          xlli_RCSR_HWR         EQU     (0x01) 
  473 00000000          xlli_RCSR_WDR         EQU     (0x02) 
  474 00000000          xlli_RCSR_SMR         EQU     (0x04) 
  475 00000000          xlli_RCSR_GPR         EQU     (0x08) 
  476 00000000          xlli_RCSR_ALL         EQU     (0xF) 
  477 00000000            
  478 00000000            
  479 00000000          ; 
  480 00000000          ;  CPSR Processor constants 
  481 00000000            
  482 00000000          xlli_CPSR_Mode_MASK   EQU       (0x0000001F) 
  483 00000000          xlli_CPSR_Mode_USR    EQU       (0x10) 
  484 00000000          xlli_CPSR_Mode_FIQ    EQU       (0x11) 
  485 00000000          xlli_CPSR_Mode_IRQ    EQU       (0x12) 
  486 00000000          xlli_CPSR_Mode_SVC    EQU       (0x13) 
  487 00000000          xlli_CPSR_Mode_ABT    EQU       (0x17) 
  488 00000000          xlli_CPSR_Mode_UND    EQU       (0x1B) 
  489 00000000          xlli_CPSR_Mode_SYS    EQU       (0x1F) 
  490 00000000            
  491 00000000          xlli_CPSR_I_Bit       EQU       (0x80) 
  492 00000000          xlli_CPSR_F_Bit       EQU       (0x40) 
  493 00000000            
  494 00000000            
  495 00000000          xlli_PWRMODE_SLEEP    EQU       (0x00000003) ; Value for cp14: Reg7 to induce sleep. 
  496 00000000            
  497 00000000                END 
   47 00000000                  INCLUDE  xlli_Mainstone_defs.inc                ; Mainstone specific include file 
    1 00000000          ; 
    2 00000000          ; Copyright (c) Microsoft Corporation.  All rights reserved. 
    3 00000000          ; 
    4 00000000          ; 
    5 00000000          ; Use of this sample source code is subject to the terms of the Microsoft 
    6 00000000          ; license agreement under which you licensed this sample source code. If 
    7 00000000          ; you did not accept the terms of the license agreement, you are not 
    8 00000000          ; authorized to use this sample source code. For the terms of the license, 
    9 00000000          ; please see the license agreement between you and Microsoft or, if applicable, 
   10 00000000          ; see the LICENSE.RTF on your install media or the root of your tools installation. 
   11 00000000          ; THE SAMPLE SOURCE CODE IS PROVIDED "AS IS", WITH NO WARRANTIES. 
   12 00000000          ; 
   13 00000000          ;********************************************************************************* 
   14 00000000          ; 
   15 00000000          ;        COPYRIGHT (c) 2002 - 2004 Intel Corporation 
   16 00000000          ; 
   17 00000000          ;   The information in this file is furnished for informational use only, 
   18 00000000          ;   is subject to change without notice, and should not be construed as 
   19 00000000          ;   a commitment by Intel Corporation. Intel Corporation assumes no 
   20 00000000          ;   responsibility or liability for any errors or inaccuracies that may appear 
   21 00000000          ;   in this document or any software that may be provided in association with 
   22 00000000          ;   this document. 
   23 00000000          ; 
   24 00000000          ;********************************************************************************* 
   25 00000000          ; 
   26 00000000          ;  FILENAME:       xlli_Mainstone_defs.inc (Platform specific addresses and 
   27 00000000          ;                  defalut values for Mainstone platform bring up) 
   28 00000000          ;                  NOTE: - This file has a def to configure xlli for MCP and non-MCP processors 
   29 00000000          ; 
   30 00000000          ; LAST MODIFIED:   13-Feb-2004 
   31 00000000          ; 
   32 00000000          ;****************************************************************************** 
   33 00000000          ; 
   34 00000000          ; 
   35 00000000          ; Include file for Mainstone specific Cross Platform Low Level Initialization (XLLI) 
   36 00000000          ; 
   37 00000000          ; 
   38 00000000          ; PLATFORM REGISTERS base address and register offsets from the base address 
   39 00000000          ; 
   40 00000000          xlli_PLATFORM_REGISTERS              EQU    0x08000000 
   41 00000000            
   42 00000000          xlli_PLATFORM_HEXLED_DATA_offset     EQU    (0x10)   ; Hex LED Data Register 
   43 00000000          xlli_PLATFORM_LED_CONTROL_offset     EQU    (0x40)   ; LED Control Register 
   44 00000000          xlli_PLATFORM_SWITCH_offset          EQU    (0x60)   ; General Purpose Switch Register 
   45 00000000          xlli_PLATFORM_MISC_WRITE1_offset     EQU    (0x80)   ; Misc Write Register 1 
   46 00000000          xlli_PLATFORM_MISC_WRITE2_offset     EQU    (0x84)   ; Misc Write Register 2 
   47 00000000          xlli_PLATFORM_MISC_READ1_offset      EQU    (0x90)   ; Misc Read Register 1 
   48 00000000          xlli_PLATFORM_INTERR_ME_offset       EQU    (0xC0)   ; Platform Interrupt Mask/Enable Register 1 
   49 00000000          xlli_PLATFORM_INTERR_SC_offset       EQU    (0xD0)   ; Platform Interrupt Set/Clear Register 1 
   50 00000000          xlli_PLATFORM_PCMCIA0_SC_offset      EQU    (0xE0)   ; PCMCIA Socket 0 Status/Control Register 
   51 00000000          xlli_PLATFORM_PCMCIA1_SC_offset      EQU    (0xE4)   ; PCMCIA Socket 1 Status/Control Register 
   52 00000000            
   53 00000000          ; 
   54 00000000          ; Platform specific bits 
   55 00000000          ; 
   56 00000000          xlli_SYS_RESET                       EQU    (0x01)   ; System reset bit 
   57 00000000            
   58 00000000          ; 
   59 00000000          ; platform GPIO pin settings (Bulverde/Mainstone) 
   60 00000000          ; 
   61 00000000          xlli_GPSR0_value          EQU   (0x00008004)   ; Set registers 
   62 00000000          xlli_GPSR1_value          EQU   (0x00020080) 
   63 00000000          xlli_GPSR2_value          EQU   (0x16C14000) 
   64 00000000          xlli_GPSR3_value          EQU   (0x0003E000) 
   65 00000000            
   66 00000000          xlli_GPCR0_value          EQU   (0x0)          ; Clear registers 
   67 00000000          xlli_GPCR1_value          EQU   (0x00000380)   ; FFUART related 
   68 00000000          xlli_GPCR2_value          EQU   (0x0) 
   69 00000000          xlli_GPCR3_value          EQU   (0x0) 
   70 00000000            
   71 00000000          xlli_GRER0_value          EQU   (0x0)          ; Rising Edge Detect 
   72 00000000          xlli_GRER1_value          EQU   (0x0) 
   73 00000000          xlli_GRER2_value          EQU   (0x0) 
   74 00000000          xlli_GRER3_value          EQU   (0x0) 
   75 00000000            
   76 00000000          xlli_GFER0_value          EQU   (0x0)          ; Falling Edge Detect 
   77 00000000          xlli_GFER1_value          EQU   (0x0) 
   78 00000000          xlli_GFER2_value          EQU   (0x0) 
   79 00000000          xlli_GFER3_value          EQU   (0x0) 
   80 00000000            
   81 00000000          xlli_GPLR0_value          EQU   (0x0)          ; Pin Level Registers 
   82 00000000          xlli_GPLR1_value          EQU   (0x0) 
   83 00000000          xlli_GPLR2_value          EQU   (0x0) 
   84 00000000          xlli_GPLR3_value          EQU   (0x0) 
   85 00000000            
   86 00000000          xlli_GEDR0_value          EQU   (0x0)          ; Edge Detect Status 
   87 00000000          xlli_GEDR1_value          EQU   (0x0) 
   88 00000000          xlli_GEDR2_value          EQU   (0x0) 
   89 00000000          xlli_GEDR3_value          EQU   (0x0) 
   90 00000000            
   91 00000000          xlli_GPDR0_value          EQU   (0xCFE3BDE4)   ; Direction Registers 
   92 00000000          xlli_GPDR1_value          EQU   (0x003FAB81) 
   93 00000000          xlli_GPDR2_value          EQU   (0x1EC3FC00) 
   94 00000000          xlli_GPDR3_value          EQU   (0x018FFE8F) 
   95 00000000            
   96 00000000          xlli_GAFR0_L_value EQU  (0x84400000)   ; Alternate function registers 
   97 00000000          xlli_GAFR0_U_value EQU  (0xA5000510) 
   98 00000000          xlli_GAFR1_L_value EQU  (0x000A9558) 
   99 00000000          xlli_GAFR1_U_value EQU  (0x0005A1AA) 
  100 00000000          xlli_GAFR2_L_value EQU  (0x60000000) 
  101 00000000          xlli_GAFR2_U_value EQU  (0x00000802) 
  102 00000000          xlli_GAFR3_L_value EQU  (0x00000000) 
  103 00000000          xlli_GAFR3_U_value EQU  (0x00000000) 
  104 00000000            
  105 00000000          ; 
  106 00000000          ; MEMORY CONTROLLER SETTINGS FOR MAINSTONE 
  107 00000000          ; 
  108 00000000            
  109 00000000          xlli_MDREFR_value  EQU   (0x0000001E) 
  110 00000000                  IF  :DEF:  xlli_FLASH_WIDTH_16_BIT 
  112 00000000                  ELSE 
  113 00000000          xlli_MSC0_DC_value EQU   (0x7FF0B8F2)     ; Bulverde Card Flash value (Non-MCP version) 
  114 00000000                  ENDIF 
  115 00000000          xlli_MSC0_MS_value EQU   (0x23F2B8F2)     ; Mainstone Board Flash value 
  116 00000000          xlli_MSC1_value    EQU   (0x0000CCD1) 
  117 00000000          xlli_MSC2_value    EQU   (0x0000B884) 
  118 00000000          xlli_MECR_value    EQU   (0x00000001) 
  119 00000000          xlli_MCMEM0_value  EQU   (0x00014307) 
  120 00000000          xlli_MCMEM1_value  EQU   (0x00014307) 
  121 00000000          xlli_MCATT0_value  EQU   (0x0001C787) 
  122 00000000          xlli_MCATT1_value  EQU   (0x0001C787) 
  123 00000000          xlli_MCIO0_value   EQU   (0x000D4B3F) 
  124 00000000          xlli_MCIO1_value   EQU   (0x000D4B3F) 
  125 00000000          xlli_FLYCNFG_value EQU   (0x00010001) 
  126 00000000          xlli_MDMRSLP_value EQU   (0x0000C008) 
  127 00000000          xlli_SXCNFG_value  EQU   (0x40044004)   ; Default value at boot up 
  128 00000000            
  129 00000000            
  130 00000000          ; 
  131 00000000          ; Optimal values for MSCO for various MemClk frequencies are listed below 
  132 00000000          ; These values are for L18 async flash 
  133 00000000          ; 
  134 00000000           IF :DEF: xlli_C0_BULVERDE 
  174 00000000              ELSE 
  175 00000000            
  176 00000000          ; This is a hack to get around some B0 timing issue where it doesn't like the optimal 
  177 00000000          ; values according to it's own SPEC!?!  These timing values are relaxed from the above optimal 
  178 00000000          ; but they work for B-step Bulverde... ugh.... 
  179 00000000            
  180 00000000          xlli_MSC0_13       EQU   (0x12101210) 
  181 00000000          xlli_MSC0_19       EQU   (0x12101210) 
  182 00000000          xlli_MSC0_26       EQU   (0x12201220)   ; 26 MHz setting 
  183 00000000          xlli_MSC0_32       EQU   (0x12201220) 
  184 00000000          xlli_MSC0_39       EQU   (0x13301330)   ; 39 MHz setting 
  185 00000000          xlli_MSC0_45       EQU   (0x13301330) 
  186 00000000          xlli_MSC0_52       EQU   (0x13401340)   ; 52 MHz setting 
  187 00000000          xlli_MSC0_58       EQU   (0x13601360) 
  188 00000000          xlli_MSC0_65       EQU   (0x13501350)   ; 65 MHz setting 
  189 00000000          xlli_MSC0_68       EQU   (0x13501350) 
  190 00000000          xlli_MSC0_71       EQU   (0x14601460)   ; 71.5 MHz setting 
  191 00000000          xlli_MSC0_74       EQU   (0x14601460) 
  192 00000000          xlli_MSC0_78       EQU   (0x14601460)   ; 78 MHz setting 
  193 00000000          xlli_MSC0_81       EQU   (0x14701470) 
  194 00000000          xlli_MSC0_84       EQU   (0x14701470)   ; 84.5 MHz setting 
  195 00000000          xlli_MSC0_87       EQU   (0x14701470) 
  196 00000000          xlli_MSC0_91       EQU   (0x14701470)   ; 91 MHz setting 
  197 00000000          xlli_MSC0_94       EQU   (0x14801480)   ; 94.2 MHz setting 
  198 00000000          xlli_MSC0_97       EQU   (0x14801480)   ; 97.5 MHz setting 
  199 00000000          xlli_MSC0_100      EQU   (0x15801580)   ; 100.7 MHz setting 
  200 00000000          xlli_MSC0_104      EQU   (0x15801580)   ; 104 MHz setting 
  201 00000000          xlli_MSC0_110      EQU   (0x15901590) 
  202 00000000          xlli_MSC0_117      EQU   (0x15A015A0)   ; 117 MHz setting 
  203 00000000          xlli_MSC0_124      EQU   (0x15A015A0) 
  204 00000000          xlli_MSC0_130      EQU   (0x15B015B0)   ; 130 MHz setting 
  205 00000000          xlli_MSC0_136      EQU   (0x16B016B0) 
  206 00000000          xlli_MSC0_143      EQU   (0x16C016C0) 
  207 00000000          xlli_MSC0_149      EQU   (0x16C016C0) 
  208 00000000          xlli_MSC0_156      EQU   (0x16C016C0) 
  209 00000000          xlli_MSC0_162      EQU   (0x16C016C0) 
  210 00000000          xlli_MSC0_169      EQU   (0x17D017D0)   ; Given that the optimal value would be 13 (RDF), but according to B0 manual, it's dif 
                        ferent 
  211 00000000          xlli_MSC0_175      EQU   (0x17C017C0) 
  212 00000000          xlli_MSC0_182      EQU   (0x17C017C0) 
  213 00000000          xlli_MSC0_188      EQU   (0x17D017D0) 
  214 00000000          xlli_MSC0_195      EQU   (0x17E017E0) 
  215 00000000          xlli_MSC0_201      EQU   (0x18E018E0) 
  216 00000000          xlli_MSC0_208      EQU   (0x18E018E0) 
  217 00000000            
  218 00000000              ENDIF ; xlli_C0_BULVERDE 
  219 00000000            
  220 00000000          ; 
  221 00000000          ; Optimal values for DTC settings for various MemClk settings (MDCNFG) 
  222 00000000          ; 
  223 00000000              IF  :DEF:  xlli_SDRAM_WIDTH_16_BIT 
  309 00000000              ELSE ; ELSE not MCP package 
  310 00000000            
  311 00000000          ; Now on a discrete MS II platform with slightly better performing SDRAM 
  312 00000000            
  313 00000000          xlli_DTC_13        EQU   (0x00000000)   ; 13 MHz setting 
  314 00000000          xlli_DTC_19        EQU   (0x00000000)   ; 19 MHz setting 
  315 00000000          xlli_DTC_26        EQU   (0x00000000)   ; 26 MHz setting 
  316 00000000          xlli_DTC_32        EQU   (0x00000000)   ; 32 MHz setting 
  317 00000000          xlli_DTC_39        EQU   (0x00000000)   ; 39 MHz setting 
  318 00000000          xlli_DTC_45        EQU   (0x00000000)   ; 45 MHz setting 
  319 00000000          xlli_DTC_52        EQU   (0x00000000)   ; 52 MHz setting 
  320 00000000          xlli_DTC_58        EQU   (0x01000100)   ; 58 MHz setting 
  321 00000000          xlli_DTC_65        EQU   (0x01000100)   ; 65 MHz setting 
  322 00000000          xlli_DTC_68        EQU   (0x01000100)   ; 68 MHz setting 
  323 00000000          xlli_DTC_71        EQU   (0x01000100)   ; 71 MHz setting 
  324 00000000          xlli_DTC_74        EQU   (0x01000100)   ; 74 MHz setting 
  325 00000000          xlli_DTC_78        EQU   (0x01000100)   ; 78 MHz setting 
  326 00000000          xlli_DTC_81        EQU   (0x01000100)   ; 81 MHz setting 
  327 00000000          xlli_DTC_84        EQU   (0x01000100)   ; 84 MHz setting 
  328 00000000          xlli_DTC_87        EQU   (0x01000100)   ; 87 MHz setting 
  329 00000000          xlli_DTC_91        EQU   (0x02000200)   ; 91 MHz setting 
  330 00000000          xlli_DTC_94        EQU   (0x02000200)   ; 94 MHz setting 
  331 00000000          xlli_DTC_97        EQU   (0x02000200)   ; 97 MHz setting 
  332 00000000          xlli_DTC_100       EQU   (0x02000200)   ; 100 MHz setting 
  333 00000000          xlli_DTC_104       EQU   (0x02000200)   ; 104 MHz setting 
  334 00000000          xlli_DTC_110       EQU   (0x01000100)   ; 110 MHz setting - SDCLK Halved 
  335 00000000          xlli_DTC_117       EQU   (0x01000100)   ; 117 MHz setting - SDCLK Halved 
  336 00000000          xlli_DTC_124       EQU   (0x01000100)   ; 124 MHz setting - SDCLK Halved 
  337 00000000          xlli_DTC_130       EQU   (0x01000100)   ; 130 MHz setting - SDCLK Halved 
  338 00000000          xlli_DTC_136       EQU   (0x01000100)   ; 136 MHz setting - SDCLK Halved 
  339 00000000          xlli_DTC_143       EQU   (0x01000100)   ; 143 MHz setting - SDCLK Halved 
  340 00000000          xlli_DTC_149       EQU   (0x01000100)   ; 149 MHz setting - SDCLK Halved 
  341 00000000          xlli_DTC_156       EQU   (0x01000100)   ; 156 MHz setting - SDCLK Halved 
  342 00000000          xlli_DTC_162       EQU   (0x01000100)   ; 162 MHz setting - SDCLK Halved 
  343 00000000          xlli_DTC_169       EQU   (0x01000100)   ; 169 MHz setting - SDCLK Halved 
  344 00000000          xlli_DTC_175       EQU   (0x01000100)   ; 175 MHz setting - SDCLK Halved 
  345 00000000          xlli_DTC_182       EQU   (0x02000200)   ; 182 MHz setting - SDCLK Halved - Close to edge, so bump up 
  346 00000000          xlli_DTC_188       EQU   (0x02000200)   ; 188 MHz setting - SDCLK Halved - Close to edge, so bump up 
  347 00000000          xlli_DTC_195       EQU   (0x02000200)   ; 195 MHz setting - SDCLK Halved - Close to edge, so bump up 
  348 00000000          xlli_DTC_201       EQU   (0x02000200)   ; 201 MHz setting - SDCLK Halved - Close to edge, so bump up 
  349 00000000          xlli_DTC_208       EQU   (0x02000200)   ; 208 MHz setting - SDCLK Halved - Close to edge, so bump up 
  350 00000000            
  351 00000000          ; 
  352 00000000          ; Optimal values for DRI settings for various MemClk settings (MDREFR) 
  353 00000000          ; 
  354 00000000          xlli_DRI_13        EQU   (0x002)   ; 13 MHz setting 
  355 00000000          xlli_DRI_19        EQU   (0x003) 
  356 00000000          xlli_DRI_26        EQU   (0x005)   ; 26 MHz setting 
  357 00000000          xlli_DRI_32        EQU   (0x006) 
  358 00000000          xlli_DRI_39        EQU   (0x008)   ; 39 MHz setting 
  359 00000000          xlli_DRI_45        EQU   (0x00A) 
  360 00000000          xlli_DRI_52        EQU   (0x00B)   ; 52 MHz setting 
  361 00000000          xlli_DRI_58        EQU   (0x00D) 
  362 00000000          xlli_DRI_65        EQU   (0x00E)   ; 65 MHz setting 
  363 00000000          xlli_DRI_68        EQU   (0x00F) 
  364 00000000          xlli_DRI_71        EQU   (0x010)   ; 71 MHz setting 
  365 00000000          xlli_DRI_74        EQU   (0x011) 
  366 00000000          xlli_DRI_78        EQU   (0x012)   ; 78 MHz setting 
  367 00000000          xlli_DRI_81        EQU   (0x012) 
  368 00000000          xlli_DRI_84        EQU   (0x013)   ; 84 MHz setting 
  369 00000000          xlli_DRI_87        EQU   (0x014) 
  370 00000000          xlli_DRI_91        EQU   (0x015)   ; 91 MHz setting 
  371 00000000          xlli_DRI_94        EQU   (0x016)   ; 94 MHz setting 
  372 00000000          xlli_DRI_97        EQU   (0x016)   ; 97 MHz setting 
  373 00000000          xlli_DRI_100       EQU   (0x017)   ; 100 MHz setting 
  374 00000000          xlli_DRI_104       EQU   (0x018)   ; 104 MHz setting 
  375 00000000          xlli_DRI_110       EQU   (0x01A) 
  376 00000000          xlli_DRI_117       EQU   (0x01B)   ; 117 MHz setting 
  377 00000000          xlli_DRI_124       EQU   (0x01D) 
  378 00000000          xlli_DRI_130       EQU   (0x01E)   ; 130 MHz setting 
  379 00000000          xlli_DRI_136       EQU   (0x020) 
  380 00000000          xlli_DRI_143       EQU   (0x021) 
  381 00000000          xlli_DRI_149       EQU   (0x023) 
  382 00000000          xlli_DRI_156       EQU   (0x025) 
  383 00000000          xlli_DRI_162       EQU   (0x026) 
  384 00000000          xlli_DRI_169       EQU   (0x028)   ; 169 MHz setting 
  385 00000000          xlli_DRI_175       EQU   (0x029) 
  386 00000000          xlli_DRI_182       EQU   (0x02B) 
  387 00000000          xlli_DRI_188       EQU   (0x02D) 
  388 00000000          xlli_DRI_195       EQU   (0x02E) 
  389 00000000          xlli_DRI_201       EQU   (0x030) 
  390 00000000          xlli_DRI_208       EQU   (0x031)   ; 208 MHz setting 
  391 00000000            
  392 00000000              ENDIF   ; xlli_SDRAM_WIDTH_16_BIT 
  393 00000000            
  394 00000000          ; SDRAM Settings 
  395 00000000              IF  :DEF:  xlli_SDRAM_WIDTH_16_BIT 
  401 00000000              ELSE 
  402 00000000          xlli_MDCNFG_value  EQU   (0x00000AC8)   ; SDRAM Config Reg (Non-MCP Version) 
  403 00000000              ENDIF 
  404 00000000            
  405 00000000          xlli_MDMRS_value   EQU   (0x00000000)   ; SDRAM Mode Reg Set Config Reg 
  406 00000000            
  407 00000000          ; 
  408 00000000          ; MEMORY PHYSICAL BASE ADDRESS(S) 
  409 00000000          ; 
  410 00000000            
  411 00000000          xlli_SRAM_PHYSICAL_BASE      EQU       (0X5C000000)  ; Physical base address for SRAM 
  412 00000000          xlli_SDRAM_PHYSICAL_BASE     EQU       (0xA0000000)  ; Physical base address for SDRAM 
  413 00000000            
  414 00000000          ; 
  415 00000000          ; CORE, SYSTEM BUS, MEMORY BUS Default frequency setting for Mainstone 
  416 00000000          ; 
  417 00000000          xlli_CCCR_value      EQU     (0x00000107)  ; Bulverde (HW reset value to start) 
  418 00000000          ; 
  419 00000000          ; Clock Enable Register (CKEN) setting 
  420 00000000          ; 
  421 00000000          xlli_CKEN_value      EQU     (0x00400200)  ; Data to be set into the clock enable register 
  422 00000000                                                     ; bit 9 enables OS timers 
  423 00000000                                                     ; Bit 22 enables memory clock 
  424 00000000          ; 
  425 00000000          ; Address where system configuration data is stored 
  426 00000000          ; 
  427 00000000          xlli_SCR_data        EQU     (0x5C03FFFC) ; Address in SRAM where system config data is stored 
  428 00000000            
  429 00000000          ; 
  430 00000000          ; Misc constants 
  431 00000000          ; 
  432 00000000          xlli_MemSize_1Mb     EQU     (0x00100000) 
  433 00000000                  IF  :DEF: xlli_SDRAM_SIZE_32_MB 
  435 00000000                  ELSE 
  436 00000000          xlli_p_PageTable      EQU     (0xA3FFC000)   ; Base address for memory Page Table (Non-MCP version) 
  437 00000000                  ENDIF 
  438 00000000          xlli_s_PageTable      EQU     (0x00004000)   ; Page Table size (4K words - 16 Kb) 
  439 00000000            
  440 00000000              IF :DEF: POST_BUILD 
  442 00000000              ELSE 
  443 00000000          xlli_v_xbBOOTROM          EQU     (0x00000000) 
  444 00000000              ENDIF; 
  445 00000000            
  446 00000000                END 
   48 00000000                  INCLUDE  xllp_Pm_SleepContext.inc               ; Definitions for this file 
    1 00000000          ; 
    2 00000000          ; Copyright (c) Microsoft Corporation.  All rights reserved. 
    3 00000000          ; 
    4 00000000          ; 
    5 00000000          ; Use of this source code is subject to the terms of the Microsoft end-user 
    6 00000000          ; license agreement (EULA) under which you licensed this SOFTWARE PRODUCT. 
    7 00000000          ; If you did not accept the terms of the EULA, you are not authorized to use 
    8 00000000          ; this source code. For a copy of the EULA, please see the LICENSE.RTF on your 
    9 00000000          ; install media. 
   10 00000000          ; 
   11 00000000          ;****************************************************************************** 
   12 00000000          ;; 
   13 00000000          ;;  COPYRIGHT (C) 2002 Intel Corporation. 
   14 00000000          ;; 
   15 00000000          ;;  This software as well as the software described in it is furnished under  
   16 00000000          ;;  license and may only be used or copied in accordance with the terms of the  
   17 00000000          ;;  license. The information in this file is furnished for informational use  
   18 00000000          ;;  only, is subject to change without notice, and should not be construed as  
   19 00000000          ;;  a commitment by Intel Corporation. Intel Corporation assumes no  
   20 00000000          ;;  responsibility or liability for any errors or inaccuracies that may appear  
   21 00000000          ;;  in this document or any software that may be provided in association with  
   22 00000000          ;;  this document.  
   23 00000000          ;;  Except as permitted by such license, no part of this document may be  
   24 00000000          ;;  reproduced, stored in a retrieval system, or transmitted in any form or by  
   25 00000000          ;;  any means without the express written consent of Intel Corporation.  
   26 00000000          ;; 
   27 00000000          ;;  FILENAME:       xllp_Pm_SleepContext.inc 
   28 00000000          ;; 
   29 00000000          ;; LAST MODIFIED:   5/28/02 
   30 00000000          ;; 
   31 00000000          ;****************************************************************************** 
   32 00000000          ; 
   33 00000000          ; 
   34 00000000          ; Include file for Bulverde Processor based platforms 
   35 00000000          ;  NOTE: This file must be kept in sync with xllp_Pm_SleepContext.h 
   36 00000000          ; 
   37 00000000              IF  :DEF: xllp_Pm_SleepContext_inc 
   38 00000000              ELSE ; IF  :DEF: xllp_Pm_SleepContext_inc 
   39 00000000          xllp_Pm_SleepContext_inc    EQU 1 
   40 00000000            
   41 00000000            
   42 00000000          ; For sanity check in checksum 
   43 00000000          XLLI_MAX_SLEEP_DATA_COUNT  EQU  0x200 
   44 00000000            
   45 00000000          XLLP_STORE_WMX_REGS_BYTES   EQU 156 
   46 00000000            
   47 00000000          WORD_SIZE                   EQU (4) 
   48 00000000            
   49 00000000          ; Template that defines the ASM-addressable part of the  
   50 00000000          ; XLLP_PM_ENTER_SLEEP_PARAMS_S structure used for the sleep parameter. 
   51 00000000          ; Note that the ASM-addressable section begins at the start of the structure. 
   52 00000000            
   53 00000000          ; ///////////////////////////////////////////////////////////////////////// 
   54 00000000          ; // 
   55 00000000          ; // Definition of parameter structure needed by XllpPmEnterSleep() 
   56 00000000          ; // 
   57 00000000          ; // Note: keep this in sync with XLLP_PM_ENTER_SLEEP_PARAMS_S defined in xllp_pm_sleepcontext.h 
   58 00000000          ;  
   59 00000000          ; typedef struct  XLLP_PM_ENTER_SLEEP_PARAMS_S 
   60 00000000          SleepParams_Data_Start              EQU  0  
   61 00000000          SleepParams_SleepDataAreaPA         EQU (SleepParams_Data_Start) 
   62 00000000          SleepParams_SleepDataAreaVA         EQU (SleepParams_SleepDataAreaPA       + WORD_SIZE) 
   63 00000000          SleepParams_PWRMODE                 EQU (SleepParams_SleepDataAreaVA        + WORD_SIZE) 
   64 00000000          SleepParams_EndOfInterestingArea    EQU (SleepParams_PWRMODE                 +WORD_SIZE) 
   65 00000000            
   66 00000000          ; End of template for ASM use.  C-level usage extends beyond this. 
   67 00000000          ; Don't base any other symbols or addressing on "SleepParams_" symbols 
   68 00000000            
   69 00000000          ;================================================================= 
   70 00000000          ;================================================================= 
   71 00000000            
   72 00000000            
   73 00000000          ; Template that defines the ASM-addressable part of the  
   74 00000000          ; XLLP_PM_SLEEP_SAVE_DATA_S structure used for the sleep saved data area. 
   75 00000000          ; Note that the ASM-addressable section begins at the start of the structure. 
   76 00000000          ; Note: keep this in sync with XLLP_PM_SLEEP_SAVE_DATA_S defined in xllp_pm_sleepcontext.h 
   77 00000000            
   78 00000000          ;typedef struct  XLLP_PM_SLEEP_SAVE_DATA_S 
   79 00000000          SleepState_Data_Start           EQU 0  
   80 00000000          SleepState_CHKSUM               EQU ( SleepState_Data_Start ) 
   81 00000000          SleepState_WordCount            EQU ( SleepState_CHKSUM          + WORD_SIZE ) 
   82 00000000          SleepState_AwakeAddr            EQU ( SleepState_WordCount       + WORD_SIZE ) 
   83 00000000          SleepState_SleepDataAreaVA      EQU ( SleepState_AwakeAddr       + WORD_SIZE ) 
   84 00000000          SleepState_SleepParamVA         EQU ( SleepState_SleepDataAreaVA + WORD_SIZE ) 
   85 00000000            
   86 00000000          ; // ARM* registers and most coprocessors must be processed locally 
   87 00000000          ; //  using assembly language. 
   88 00000000          ; // ARM* unique registers 
   89 00000000          ;  
   90 00000000          SleepState_ENTRY_CPSR           EQU ( SleepState_SleepParamVA  + WORD_SIZE ) 
   91 00000000          SleepState_ENTRY_SP             EQU ( SleepState_ENTRY_CPSR  + WORD_SIZE ) 
   92 00000000          SleepState_ENTRY_SPSR           EQU ( SleepState_ENTRY_SP    + WORD_SIZE ) 
   93 00000000          SleepState_SYS_SP               EQU ( SleepState_ENTRY_SPSR  + WORD_SIZE ) 
   94 00000000          SleepState_FIQ_SP               EQU ( SleepState_SYS_SP      + WORD_SIZE ) 
   95 00000000          SleepState_ABT_SP               EQU ( SleepState_FIQ_SP      + WORD_SIZE ) 
   96 00000000          SleepState_IRQ_SP               EQU ( SleepState_ABT_SP      + WORD_SIZE ) 
   97 00000000          SleepState_UND_SP               EQU ( SleepState_IRQ_SP      + WORD_SIZE ) 
   98 00000000          SleepState_SVC_SP               EQU ( SleepState_UND_SP      + WORD_SIZE ) 
   99 00000000            
  100 00000000          ; // Saved Coprocessor regs other than CP0+1 (includes MMU values) 
  101 00000000          SleepState_Cp15_ACR_MMU         EQU ( SleepState_SVC_SP         + WORD_SIZE ) 
  102 00000000          SleepState_Cp15_AUXCR_MMU       EQU ( SleepState_Cp15_ACR_MMU   + WORD_SIZE ) 
  103 00000000          SleepState_Cp15_TTBR_MMU        EQU ( SleepState_Cp15_AUXCR_MMU + WORD_SIZE ) 
  104 00000000          SleepState_Cp15_DACR_MMU        EQU ( SleepState_Cp15_TTBR_MMU  + WORD_SIZE ) 
  105 00000000          SleepState_Cp15_PID_MMU         EQU ( SleepState_Cp15_DACR_MMU  + WORD_SIZE ) 
  106 00000000          SleepState_Cp15_CPAR            EQU (SleepState_Cp15_PID_MMU    + WORD_SIZE ) 
  107 00000000          SleepState_EndOfInterestingArea EQU ( SleepState_Cp15_CPAR) 
  108 00000000            
  109 00000000          ; End of template for ASM use.  C-level usage extends beyond this. 
  110 00000000          ; Don't base any other symbols or addressing on "SleepState_" symbols 
  111 00000000            
  112 00000000            
  113 00000000            
  114 00000000          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 
  115 00000000          ;; 
  116 00000000          ;;  Some important constants that aren't defined elsewhere 
  117 00000000          ;; 
  118 00000000          ;; 
  119 00000000          ;; Intel XScale Core Developers Manual December, 2000 
  120 00000000          ;; 
  121 00000000            
  122 00000000          ; AND masks: all zero bits are read-as-0, write-as-0. 
  123 00000000            
  124 00000000          XLLP_VLD_MSK_ALL             EQU    (0xFFFFFFFF) 
  125 00000000            
  126 00000000              ; Bits 6:3 must be ones when written, but they are also read as ones - 
  127 00000000              ;  so they are treated as simply valid for save/restore purposes. 
  128 00000000          XLLP_CP15_ACR_MMU_VLD_MSK    EQU    (0x00003BFF) ;CP15, CRn1, opcode_2 = 0 
  129 00000000              ; P-bit (bit 1) not implemented for this processor 
  130 00000000          XLLP_CP15_AUXCR_MMU_VLD_MSK  EQU    (0x00000031)  ;CP15, CRn1, opcode_2 = 1 
  131 00000000          XLLP_CP15_TTBR_MMU_VLD_MSK   EQU    (0xFFFFC000)  ;CP15, CRn2 
  132 00000000          XLLP_CP15_DACR_MMU_VLD_MSK   EQU    XLLP_VLD_MSK_ALL 
  133 00000000          XLLP_CP15_PID_MMU_VLD_MSK    EQU    (0xFE000000) ; p15, 0, Rd, c13, c0, 0 
  134 00000000          XLLP_CP15_CPAR_VLD_MSK       EQU    (0x00003FFF) ; Cp15, CR15; CRm1, opcode_2=0 
  135 00000000            
  136 00000000            
  137 00000000                  ENDIF ; ELSE ; IF  :DEF: xllp_Pm_SleepContext_inc 
  138 00000000            
  139 00000000              END 
   49 00000000           IF 1=0 
   51 00000000           ENDIF ;0 : development LED markers 
   52 00000000          ; 
   53                           AREA    |.text|, CODE, READONLY, ALIGN=5        ; Align =5 required for "ALIGN 32" to work 
   54 00000000          ; 
   55 00000000          ; Functions made public by this file: 
   56 00000000          ; 
   57 00000000                  EXPORT XllpPmEnterSleep 
   58 00000000                  EXPORT XllpPmChecksumSleepDataVi 
   59 00000000                  EXPORT XllpPmRestoreAfterSleep                   ; Not called by name elsewhere. 
   60 00000000            
   61 00000000          ; 
   62 00000000          ; External functions required for this file: 
   63 00000000          ; 
   64 00000000                  IMPORT XllpPmSleepCLevelProcessing 
   65 00000000                  IMPORT XllpPmWakeCLevelProcessing 
   66 00000000            
   67 00000000          ;************************************************************************************************** 
   68 00000000          ; 
   69 00000000          ; XllpPmChecksumSleepDataVi 
   70 00000000          ; 
   71 00000000          ; Does not assume a stack or MMU enable/disable state. 
   72 00000000          ;  
   73 00000000          ; Inputs:  
   74 00000000          ;       R0: Base address of area to checksum 
   75 00000000          ;       R1: Number of 4-byte words in area 
   76 00000000          ;       Assumes return address in link register 
   77 00000000          ; 
   78 00000000          ; Returns: 
   79 00000000          ;       R0: Checksum 
   80 00000000          ; 
   81 00000000          ; Uses: R0, R1, R2, R3 
   82 00000000          ; 
   83 00000000            
   84 00000000            
   85 00000000          XllpPmChecksumSleepDataVi  FUNCTION 
   86 00000000            
   87 00000000              ; do Checksum on the buffer 
   88 00000000            
   89 00000000 e59f21a4     ldr     r2, =(0x5A72)                  ; Pick a non-zero seed. 
   90 00000004          XllpPmCheckSumSleepDataVi_Lab1 
   91 00000004 e4903004     ldr     r3, [r0], #4                   ; get value and increment pointer 
   92 00000008 e0822003     add     r2, r2,   r3 
   93 0000000c e1a02fe2     mov     r2, r2,   ROR #31              ; Rotate left by one bit position 
   94 00000010 e2511001     subs    r1, r1,   #1                   ; Count down for entire buffer size 
   95 00000014 1afffffa     bne     XllpPmCheckSumSleepDataVi_Lab1 
   96 00000018 e1a00002     mov     r0, r2 
   97 0000001c            
   98 0000001c              IF :DEF: Interworking 
   99 0000001c                  IF Interworking :LOR: Thumbing 
  100 0000001c e12fff1e          bx  lr 
  101 00000020                  ELSE 
  103 00000020                  ENDIF ; ELSE of IF Interworking :LOR: Thumbing 
  104 00000020              ELSE ; IF :DEF: Interworking 
  106 00000020              ENDIF ; ELSE of IF :DEF: Interworking 
  107 00000020            
  108 00000020              ENDFUNC 
  109 00000020            
  110 00000020          ;; End of XllpPmChecksumSleepDataVi() 
  111 00000020          ;************************************************************************************************** 
  112 00000020            
  113 00000020            
  114 00000020          ;****************************************************************************** 
  115 00000020          ; 
  116 00000020          ; 
  117 00000020          ;       ******************** 
  118 00000020          ;       *                  *  
  119 00000020          ;       * XllpPmEnterSleep * 
  120 00000020          ;       *                  * 
  121 00000020          ;       ******************** 
  122 00000020          ; 
  123 00000020          ; 
  124 00000020          ; NOTES: Written for the Bulverde Processor on the Mainstone Development Platform. 
  125 00000020          ; 
  126 00000020          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;      
  127 00000020          ;    XllpPmEnterSleep() is an assembly-coded function that: 
  128 00000020          ;      Saves processor and some coprocessor register context. 
  129 00000020          ;      Performs a checksum and stores it in the saved data area. 
  130 00000020          ;      Performs some final platform-level shutdown. 
  131 00000020          ;      Configures the processor Power Manager sleep state registers. 
  132 00000020          ;      Places the physical address of the saved data area in the PSPR. 
  133 00000020          ;      Puts the processor to sleep.  
  134 00000020          ; Expects RO to have the parameter structure address 
  135 00000020          ; Prototype: 
  136 00000020          ;    XllpPmEnterSleep(P_XLLP_PM_ENTER_SLEEP_PARAMS_T) 
  137 00000020          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;      
  138 00000020            
  139 00000020          XllpPmEnterSleep   FUNCTION 
  140 00000020            
  141 00000020              ; (This assumes only some trusted processor mode and the existence of stacks for all modes) 
  142 00000020              ; 9.2.1:    Save ARM registers 
  143 00000020              ; Save r0-r12 + lr (r14) onto current stack (sp=r13) 
  144 00000020 e92d5fff     stmdb   sp!, {r0-r12,lr}                        ; Push entry mode state onto our stack 
  145 00000024            
  146 00000024              ; Move parameter pointer to r4 for protection from C functions. 
  147 00000024 e1a04000     mov     r4, r0  
  148 00000028 e5945004     ldr     r5, [r4, #SleepParams_SleepDataAreaVA]  ;Get sleep state save area addr 
  149 0000002c            
  150 0000002c              ; 
  151 0000002c              ; Protect R4+R5 until further notice 
  152 0000002c              ; For processor register storage sequence, use r3 only to set up CPSR. 
  153 0000002c              ; 
  154 0000002c            
  155 0000002c              ; Store CPSR, sp and (if not SYS mode) SPSR 
  156 0000002c e10f3000     mrs     r3, cpsr 
  157 00000030 e5853014     str     r3, [r5, #SleepState_ENTRY_CPSR] 
  158 00000034 e585d018     str     sp, [r5, #SleepState_ENTRY_SP] 
  159 00000038            
  160 00000038 e3a0201f     ldr     r2, =xlli_CPSR_Mode_SYS             ; Mbit pattern for SYS mode, which has no SPSR 
  161 0000003c e0031002     and     r1, r3, r2                          ; Isolate "M" bits from CPSR 
  162 00000040 e1510002     cmp     r1, r2                              ; identical? if so, skip nonexistent SPSR 
  163 00000044 114f2000     mrsne   r2, spsr                            ; undefined operation if SPSR doesn't exist. 
  164 00000048 1585201c     strne   r2, [r5, #SleepState_ENTRY_SPSR] 
  165 0000004c            
  166 0000004c              ;     
  167 0000004c              ;    Enter SYS mode and save r8-r12 + lr (r14) onto stack 
  168 0000004c              ;    Store sp (no SPSR) 
  169 0000004c e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) ; cpsr still in r3 
  170 00000050 e38330df     orr     r3, r3, #(xlli_CPSR_Mode_SYS:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter SYS mode, no interrupts 
  171 00000054 e121f003     msr     cpsr_c, r3                      ; Only interested in control fields 
  172 00000058                                                      ; Push SYS state onto our stack 
  173 00000058 e92d5f00     stmdb   sp!, {r8-r12,lr}                ; Save R8 and up, in case entry mode was FIQ 
  174 0000005c e585d020     str     sp, [r5, #SleepState_SYS_SP] 
  175 00000060              ;     
  176 00000060              ; Enter each of these modes and save their mode-unique registers (in parentheses) 
  177 00000060              ; onto the stack, then store SP and SPSR for eacn. 
  178 00000060              ;     
  179 00000060              ;FIQ (r8-r12, r14, SPSR on stack; store SP) 
  180 00000060              ; (For FIQ, put Saved PSR into r2 and save r2,r8..12, sp and lr) 
  181 00000060              ;  r3 still has CPSR template in it. 
  182 00000060 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  183 00000064 e38330d1     orr     r3, r3, #(xlli_CPSR_Mode_FIQ:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit); Enter FIQ mode, no interrupts 
  184 00000068 e121f003     msr     cpsr_c, r3          ; Only interested in control fields 
  185 0000006c            
  186 0000006c e14f2000     mrs     r2, spsr  
  187 00000070 e92d5f04     stmdb   sp!, {r2, r8-r12,lr}            ; Save SPSR, LR and R8-R12, 
  188 00000074 e585d024     str     sp, [r5, #SleepState_FIQ_SP]    ; Store SP 
  189 00000078            
  190 00000078              ; IRQ (r14, SPSR on stack; store SP) 
  191 00000078              ;  r3 still has CPSR template in it. 
  192 00000078 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  193 0000007c e38330d2     orr     r3, r3, #(xlli_CPSR_Mode_IRQ:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter IRQ mode, no interrupts 
  194 00000080 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  195 00000084            
  196 00000084 e14f2000     mrs     r2, spsr  
  197 00000088 e92d4004     stmdb   sp!, {r2, lr}                   ; Save SPSR and LR 
  198 0000008c e585d02c     str     sp, [r5, #SleepState_IRQ_SP]    ; Store SP 
  199 00000090            
  200 00000090              ; ABT (r14, SPSR on stack; store SP) 
  201 00000090              ; r3 still has CPSR template in it. 
  202 00000090 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  203 00000094 e38330d7     orr     r3, r3, #(xlli_CPSR_Mode_ABT:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter ABT mode, no interrupts 
  204 00000098 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  205 0000009c            
  206 0000009c e14f2000     mrs     r2, spsr  
  207 000000a0 e92d4004     stmdb   sp!, {r2, lr}                   ; Save SPSR and LR 
  208 000000a4 e585d028     str     sp, [r5, #SleepState_ABT_SP]    ; Store SP 
  209 000000a8            
  210 000000a8              ; UND (r14, SPSR on stack; store SP) 
  211 000000a8              ; r3 still has CPSR template in it. 
  212 000000a8 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  213 000000ac e38330db     orr     r3, r3, #(xlli_CPSR_Mode_UND:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter UND mode, no interrupts 
  214 000000b0 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  215 000000b4            
  216 000000b4 e14f2000     mrs     r2, spsr  
  217 000000b8 e92d4004     stmdb   sp!, {r2, lr}                   ; Save SPSR and LR 
  218 000000bc e585d030     str     sp, [r5, #SleepState_UND_SP]    ; Store SP 
  219 000000c0            
  220 000000c0              ; SVC (r14, SPSR on stack; store SP) 
  221 000000c0              ; r3 still has CPSR template in it. 
  222 000000c0 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  223 000000c4 e38330d3     orr     r3, r3, #(xlli_CPSR_Mode_SVC:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter SVC mode, no interrupts 
  224 000000c8 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  225 000000cc            
  226 000000cc e14f2000     mrs     r2, spsr  
  227 000000d0 e92d4004     stmdb   sp!, {r2, lr}                   ; Save SPSR and LR 
  228 000000d4 e585d034     str     sp, [r5, #SleepState_SVC_SP]    ; Store SP 
  229 000000d8            
  230 000000d8            
  231 000000d8              ; (Don't explicitly save USR context; there are no unique USR mode registers;  
  232 000000d8              ;       any registers not shared with other modes are shared with SYS mode.) 
  233 000000d8            
  234 000000d8              ; Continue from here using SVC mode's stack, now that all  processor registers are saved. 
  235 000000d8            
  236 000000d8              ; 
  237 000000d8              ; End r3 reserved sequence; continue to protect r4, r5 
  238 000000d8              ; 
  239 000000d8              ; r5 is pointer to sleep save data area 
  240 000000d8            
  241 000000d8              ; Cp15_ACR_MMU 
  242 000000d8 ee110f10     mrc     p15, 0, r0, c1, c0, 0               ; load r0 with MMU Control 
  243 000000dc e59f10cc     ldr     r1, =XLLP_CP15_ACR_MMU_VLD_MSK      ; mask off the undefined bits 
  244 000000e0 e0000001     and     r0, r0, r1 
  245 000000e4 e5850038     str     r0, [r5, #SleepState_Cp15_ACR_MMU]  ; store MMU Control data 
  246 000000e8            
  247 000000e8              ; Cp15_AUXCR_MMU;   // cp15 Reg1:1: assume restored elsewhere. 
  248 000000e8 ee110f11     mrc     p15, 0, r0, c1, c1, 0               ; load r0 with MMU Aux Control 
  249 000000ec e3a01031     ldr     r1, =XLLP_CP15_AUXCR_MMU_VLD_MSK    ; mask off the undefined bits 
  250 000000f0 e0000001     and     r0, r0, r1 
  251 000000f4 e585003c     str     r0, [r5, #SleepState_Cp15_AUXCR_MMU] ; store MMU Aux Control data 
  252 000000f8            
  253 000000f8              ; Cp15_TTBR_MMU;    // cp15 Reg2:0 
  254 000000f8 ee120f10     mrc     p15, 0, r0, c2, c0, 0               ; load r0 with TTB address. 
  255 000000fc e59f10b0     ldr     r1, =XLLP_CP15_TTBR_MMU_VLD_MSK     ; mask off the undefined bits 
  256 00000100 e0000001     and     r0, r0, r1 
  257 00000104 e5850040     str     r0, [r5, #SleepState_Cp15_TTBR_MMU] ; store TTB address 
  258 00000108            
  259 00000108              ; Cp15_DACR_MMU;    // cp15 Reg3:0, all bits valid 
  260 00000108 ee130f10     mrc     p15, 0, r0, c3, c0, 0               ; load r0 with domain access control. 
  261 0000010c e5850044     str     r0, [r5, #SleepState_Cp15_DACR_MMU] ; store domain access control 
  262 00000110            
  263 00000110              ; Cp15_PID_MMU;              // cp15 Reg13; Assume set by OS if used. 
  264 00000110 ee1d0f10     mrc     p15, 0, r0, c13, c0, 0              ; load r0 with PID. 
  265 00000114 e3a014fe     ldr     r1, =XLLP_CP15_PID_MMU_VLD_MSK      ; mask off the undefined bits 
  266 00000118 e0000001     and     r0, r0, r1 
  267 0000011c e5850048     str     r0, [r5, #SleepState_Cp15_PID_MMU]  ; store PID 
  268 00000120              ; 
  269 00000120              ; Save Coprocessor Access Register value before modifying to get CP0 
  270 00000120              ;  Cp15_CPAR;      // cp15 Reg15 
  271 00000120 ee1f0f11     mrc     p15, 0, r0, c15, c1, 0              ; load r0 with Coprocessor Access Register. 
  272 00000124 e59f108c     ldr     r1, =XLLP_CP15_CPAR_VLD_MSK         ; mask off the undefined bits 
  273 00000128 e0000001     and     r0, r0, r1 
  274 0000012c e585004c     str     r0, [r5, #SleepState_Cp15_CPAR]     ; store Coprocessor Access Register 
  275 00000130              ; Now enable access to all valid coprocessors 
  276 00000130 ee0f1f11     mcr     p15, 0, r1, c15, c1, 0        
  277 00000134              ;    CPWAIT  00000000 
  278 00000134               
  279 00000134 ee120f10     mrc     p15, 0, r0, c2, c0, 0               ; arbitrary read of CP15 
  280 00000138 e1a00000     mov     r0, r0                              ; wait for it (foward dependency) 
  281 0000013c e24ff004     sub     pc, pc, #4                          ; branch to next instruction 
  282 00000140            
  283 00000140              ;; Moving to C-level code for everything except the final sleep command. 
  284 00000140            
  285 00000140 e1a00004     mov     r0, r4  ; C function expects the parameter pointer we got. 
  286 00000144            
  287 00000144 e92d4000     stmdb   sp!, {lr} 
  288 00000148 eb000000     bl      XllpPmSleepCLevelProcessing  
  289 0000014c e8bd4000     ldmia   sp!, {lr} 
  290 00000150            
  291 00000150 e1a00000     nop 
  292 00000154 e1a00000     nop 
  293 00000158 e1a00000     nop 
  294 0000015c e1a00000     nop 
  295 00000160            
  296 00000160              ;    r0: contains start address 
  297 00000160              ;    r2: contains count 
  298 00000160              ;    uses: r2,r3,r4,r5,r6 
  299 00000160            
  300 00000160            
  301 00000160              ;  Enter specified power mode 
  302 00000160 e5943008     ldr     r3, [r4, #SleepParams_PWRMODE] 
  303 00000164            
  304 00000164 ea000005     b   XllpPmEnterSleep_Lab1     ; Purely precautionary, in case we needed to clear pipeline 
  305 00000168 00 00 00     ALIGN  32 
               00 00 00   
               00 00 00   
               00 00 00   
               00 00 00   
               00 00 00   
               00 00 00   
               00 00 00   
  306 00000180          XllpPmEnterSleep_Lab1 
  307 00000180 ee073e10     mcr     p14, 0, r3, c7, c0, 0                   ; Enter sleep 
  308 00000184            
  309 00000184 e1a00000     nop 
  310 00000188 e1a00000     nop 
  311 0000018c e1a00000     nop 
  312 00000190 e1a00000     nop 
  313 00000194 e1a00000     nop 
  314 00000198 e1a00000     nop 
  315 0000019c e1a00000     nop 
  316 000001a0 e1a00000     nop 
  317 000001a4            
  318 000001a4              ;------------------------------------------------------------------------ 
  319 000001a4              ; We are now down (and should never get here ...) 
  320 000001a4            
  321 000001a4          ; Skip for now. 
  322 000001a4          ;    IF BSP_MAINSTONE = "1" 
  323 000001a4          ; 
  324 000001a4          ;        ldr     r1, =(FPGA_REGS_BASE_U_VIRTUAL) 
  325 000001a4          ;        mov     r0, #0 
  326 000001a4          ;        ldr     r0, [r1, #BLANKLED_OFFSET]   ; Enable all LEDs 
  327 000001a4          ;        ldr     r0, =(0x88880666)            ; Failure code for non-sleeping 
  328 000001a4          ;        str     r0, [r1, #HEXLED_OFFSET] 
  329 000001a4          ; 
  330 000001a4          ;    ENDIF; :DEF: BSP_MAINSTONE 
  331 000001a4            
  332 000001a4          XllpPmEnterSleep_Lab2 
  333 000001a4 eafffffe     b       XllpPmEnterSleep_Lab2                            ; don't let it fall through 
  334 000001a8            
  335 000001a8              IF :DEF: Interworking 
  336 000001a8                  IF Interworking :LOR: Thumbing 
  337 000001a8 e12fff1e          bx  lr 
  338 000001ac                  ELSE 
  340 000001ac                  ENDIF ; ELSE of IF Interworking :LOR: Thumbing 
  341 000001ac              ELSE ; IF :DEF: Interworking 
  343 000001ac              ENDIF ; ELSE OF IF :DEF: Interworking 
  344 000001ac            
  345 000001ac              ENDFUNC 
  346 000001ac            
  347 000001ac            
  348 000001ac          ;; End of XllpPmEnterSleep() 
  349 000001ac          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 
  350 000001ac            
  351 000001ac          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 
  352 000001ac          ; 
  353 000001ac          ; XllpPmRestoreAfterSleep() 
  354 000001ac          ; 
  355 000001ac          ; Expects: 
  356 000001ac          ;    R0: Virtual address of of the saved data area (XllpPmSleepDataArea).   
  357 000001ac          ;         - Physical address was  obtained from the PSPR at wakeup. 
  358 000001ac          ;    R1: RCSR (bits 15:0 in 15:0 of R1) + PSSR (bits 15:0 in 31:16 of R1) 
  359 000001ac          ; 
  360 000001ac          ;    Assumes virtual mode and that all MMU registers are already restored. 
  361 000001ac            
  362 000001ac 00005a72 *literal pool: constant 
  362 000001b0 00003bff *literal pool: constant 
  362 000001b4 ffffc000 *literal pool: constant 
  362 000001b8 00003fff *literal pool: constant 
  362 000001ac              LTORG 
  363 000001bc          XllpPmRestoreAfterSleep   FUNCTION 
  364 000001bc            
  365 000001bc          ; Move sleep data area virtual address in to r5, same as before sleep 
  366 000001bc          ; Save wakeup status data from r1 into r6 
  367 000001bc            
  368 000001bc e1a05000     mov     r5, r0 
  369 000001c0 e1a06001     mov     r6, r1 
  370 000001c4 e5954010     ldr     r4, [r5, #SleepState_SleepParamVA]    ; Get parameter struct addr 
  371 000001c8            
  372 000001c8          ;   Protect r4, r5 and r6 until further notice. 
  373 000001c8            
  374 000001c8            
  375 000001c8          ;Enter and restore the register contexts for these processor modes: 
  376 000001c8            
  377 000001c8          ;   Use r3 for CPSR template until further notice. 
  378 000001c8            
  379 000001c8          ;Enter SYS mode and restore r8-r12 + lr (r14) from stack 
  380 000001c8          ;     (no SPSR) 
  381 000001c8          ;     
  382 000001c8 e10f3000     mrs     r3, cpsr 
  383 000001cc e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  384 000001d0 e38330df     orr     r3, r3, #(xlli_CPSR_Mode_SYS:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter SYS mode, no interrupts 
  385 000001d4 e121f003     msr     cpsr_c, r3                      ; Only interested in control fields 
  386 000001d8 e595d020     ldr     sp, [r5, #SleepState_SYS_SP]    ; Get saved  sp 
  387 000001dc                                                      ; Pop SYS state from our stack 
  388 000001dc e8bd5f00     ldmia   sp!, {r8-r12,lr}                ; Restore R8 and up - no SPSR 
  389 000001e0            
  390 000001e0            
  391 000001e0          ;   FIQ (r8-r12, r14, SPSR on stack; store SP) 
  392 000001e0              ;    // For FIQ, get Saved PSR into r2 and restore ,r8..12, sp and lr) 
  393 000001e0              ;  r3 still has CPSR template in it. 
  394 000001e0 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  395 000001e4 e38330d1     orr     r3, r3, #(xlli_CPSR_Mode_FIQ:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter FIQ mode, no interrupts 
  396 000001e8 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  397 000001ec e595d024     ldr     sp, [r5, #SleepState_FIQ_SP]    ; Get saved  sp 
  398 000001f0 e8bd5f04     ldmia   sp!, {r2, r8-r12,lr}            ; Saved SPSR, LR and R8-R12, 
  399 000001f4 e16ff002     msr     spsr_cxsf, r2   
  400 000001f8            
  401 000001f8          ;  IRQ (r14, SPSR on stack; stored SP) 
  402 000001f8              ;  r3 still has CPSR template in it. 
  403 000001f8 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  404 000001fc e38330d2     orr     r3, r3, #(xlli_CPSR_Mode_IRQ:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter IRQ mode, no interrupts 
  405 00000200 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  406 00000204 e595d02c     ldr     sp, [r5, #SleepState_IRQ_SP]    ; Stored SP 
  407 00000208 e8bd4004     ldmia   sp!, {r2, lr}                   ; Saved SPSR and LR 
  408 0000020c e16ff002     msr     spsr_cxsf, r2   
  409 00000210            
  410 00000210          ;   ABT (r14, SPSR on stack; stored SP) 
  411 00000210              ;  r3 still has CPSR template in it. 
  412 00000210 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  413 00000214 e38330d7     orr     r3, r3, #(xlli_CPSR_Mode_ABT:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter ABT mode, no interrupts 
  414 00000218 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  415 0000021c e595d028     ldr     sp, [r5, #SleepState_ABT_SP]    ; Stored SP 
  416 00000220 e8bd4004     ldmia   sp!, {r2, lr}                   ; Saved SPSR and LR 
  417 00000224 e16ff002     msr     spsr_cxsf, r2   
  418 00000228            
  419 00000228          ;   UND (r14, SPSR on stack; stored SP) 
  420 00000228              ;  r3 still has CPSR template in it. 
  421 00000228 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  422 0000022c e38330db     orr     r3, r3, #(xlli_CPSR_Mode_UND:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter UND mode, no interrupts 
  423 00000230 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  424 00000234 e595d030     ldr     sp, [r5, #SleepState_UND_SP]    ; Stored SP 
  425 00000238 e8bd4004     ldmia   sp!, {r2, lr}                   ; Saved SPSR and LR 
  426 0000023c e16ff002     msr     spsr_cxsf, r2   
  427 00000240            
  428 00000240            
  429 00000240          ; Enter SVC mode and restore only its saved sp. 
  430 00000240            
  431 00000240          ;   SVC (r14, SPSR on stack; store SP) 
  432 00000240              ;  r3 still has CPSR template in it. 
  433 00000240 e3c3301f     bic     r3, r3, #(xlli_CPSR_Mode_MASK) 
  434 00000244 e38330d3     orr     r3, r3, #(xlli_CPSR_Mode_SVC:OR:xlli_CPSR_I_Bit:OR:xlli_CPSR_F_Bit) ; Enter SVC mode, no interrupts 
  435 00000248 e121f003     msr     cpsr_c, r3 ; Only interested in control fields 
  436 0000024c e595d034     ldr     sp, [r5, #SleepState_SVC_SP]    ; Stored SP 
  437 00000250            
  438 00000250          ; (Don't explicitly restore USR context; there are no unique USR mode registers;  
  439 00000250          ;       any registers not shared with other modes are shared with SYS mode.) 
  440 00000250            
  441 00000250          ;   ============== 
  442 00000250          ;   Leaving SVC mode context unrestored, use its stack for 
  443 00000250          ;   general restoration processing 
  444 00000250          ;   End protection of r3 
  445 00000250          ;   ============== 
  446 00000250            
  447 00000250              ;; Moving to C-level code for everything except CPAR restoration, SVC 
  448 00000250              ;    restoration and original mode restoration 
  449 00000250            
  450 00000250              ; Enable access to all valid coprocessors  (needed for restore CP0+1 in XllpPmWakeCLevelProcessing() 
  451 00000250 e59f105c     ldr     r1, =XLLP_CP15_CPAR_VLD_MSK     ; mask off the undefined bits 
  452 00000254 ee0f1f11     mcr     p15, 0, r1, c15, c1, 0       
  453 00000258              ;    CPWAIT  00000000 
  454 00000258            
  455 00000258 ee120f10     mrc     p15, 0, r0, c2, c0, 0           ; arbitrary read of CP15 
  456 0000025c e1a00000     mov     r0, r0                          ; wait for it (foward dependency) 
  457 00000260 e24ff004     sub     pc, pc, #4                      ; branch to next instruction 
  458 00000264            
  459 00000264 e1a00004     mov     r0, r4  ; C function expects the parameter pointer 
  460 00000268 e1a01005     mov     r1, r5  ; and pointer to saved data area 
  461 0000026c e1a02006     mov     r2, r6  ; and Wakeup info from startup 
  462 00000270 eb000000     bl      XllpPmWakeCLevelProcessing  
  463 00000274            
  464 00000274 e595004c     ldr     r0, [r5, #SleepState_Cp15_CPAR] ; Get saved Coproc Access Reg 
  465 00000278 ee0f0f11     mcr     p15, 0, r0, c15, c1, 0          ; restore Coprocessor Access Register. 
  466 0000027c            
  467 0000027c            
  468 0000027c          ;   Still in SVC mode 
  469 0000027c          ;   Restore unique SVC register context 
  470 0000027c e8bd4004     ldmia   sp!, {r2, lr}                   ; Saved SPSR and LR 
  471 00000280 e16ff002     msr     spsr_cxsf, r2   
  472 00000284            
  473 00000284          ;  Re-establish whatever mode was in use at the time XllpPmEnterSleep() was 
  474 00000284          ;  invoked and restore complete register context.  Before restoring the SPSR,  
  475 00000284          ;  make sure that the entry mode was not SYS mode, which has no SPSR. 
  476 00000284            
  477 00000284          ;   Load CPSR, sp and (if not SYS mode) SPSR 
  478 00000284 e5953014     ldr     r3, [r5, #SleepState_ENTRY_CPSR] 
  479 00000288 e121f003     msr     cpsr_c, r3 ; Only interested in control fields for now, will trash flags 
  480 0000028c e3a0201f     ldr     r2, =xlli_CPSR_Mode_SYS         ; Mbit pattern for SYS mode, which has no SPSR 
  481 00000290 e0033002     and     r3, r3, r2                      ; Isolate "M" bits from CPSR 
  482 00000294 e1530002     cmp     r3, r2                          ; identical? if so, skip nonexistent SPSR 
  483 00000298 1595201c     ldrne   r2, [r5, #SleepState_ENTRY_SPSR] 
  484 0000029c 116ff002     msrne   spsr_cxsf, r2   
  485 000002a0 e5953014     ldr     r3, [r5, #SleepState_ENTRY_CPSR]  
  486 000002a4 e12ff003     msr     cpsr_cxsf, r3                   ; Restore original mode status and flags 
  487 000002a8 e595d018     ldr     sp, [r5, #SleepState_ENTRY_SP] 
  488 000002ac            
  489 000002ac e8bd5fff     ldmia   sp!, {r0-r12,lr}                ; Pop entry mode state from stack 
  490 000002b0            
  491 000002b0          ;  Branch to lr location (Caller sees this as return from XllpPmEnterSleep()). 
  492 000002b0            
  493 000002b0              IF :DEF: Interworking 
  494 000002b0                  IF Interworking :LOR: Thumbing 
  495 000002b0 e12fff1e          bx  lr 
  496 000002b4                  ELSE 
  498 000002b4                  ENDIF ; ELSE of IF Interworking :LOR: Thumbing 
  499 000002b4              ELSE ; IF :DEF: Interworking 
  501 000002b4              ENDIF ; ELSE of IF :DEF: Interworking 
  502 000002b4            
  503 000002b4              ENDFUNC 
  504 000002b4            
  505 000002b4          ;; End of XllpPmRestoreAfterSleep() 
  506 000002b4          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 
  507 000002b4            
  508 000002b4              IF 0=1 
  562 000002b4              ENDIF ; 0=1 
  563 000002b4            
  564 000002b4            
  565 000002b4              END 
  566 000002b4 00003fff *literal pool: constant 
Assembly terminated, errors: 0, warnings: 0 
